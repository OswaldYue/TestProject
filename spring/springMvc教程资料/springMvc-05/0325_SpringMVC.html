<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3249"/>
<h1>1、SpringMVC简介</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/19 9:11</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/19 9:55</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>1、Spring实现web模块的；简化web开发的；</div><div><img src="0325_SpringMVC_files/Image.png" type="image/png" style="height: auto;"/></div><div>SpringMVC==Spring的web模块；</div><div>MVC：</div><div><img src="0325_SpringMVC_files/Image [1].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><hr/></div><div><span style="font-size:24.0pt;font-family:&quot;Arial Unicode MS&quot;; mso-ascii-font-family:&quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;; mso-bidi-font-family:&quot;Arial Unicode MS&quot;;color:black;mso-color-index:1; mso-font-kerning:12.0pt;language:en-US;mso-style-textfill-type:solid; mso-style-textfill-fill-themecolor:text1;mso-style-textfill-fill-color:black; mso-style-textfill-fill-alpha:100.0%">POJO：Plain Old Java Object；</span></div><div><img src="0325_SpringMVC_files/Image [2].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><hr/></div><div>HelloWorld：</div><div>0）、</div><div><img src="0325_SpringMVC_files/Image [3].png" type="image/png" style="height: auto;"/></div><div>1）、导包</div><div>          1）、SpringMVC是Spring的web模块；所有模块的运行都是依赖核心模块（IOC模块）</div><div>                    1）、核心容器模块：</div><div>                              
<div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>  commons-logging-1.1.3.jar</div><div>spring-aop-4.0.0.RELEASE.jar</div><div>spring-beans-4.0.0.RELEASE.jar</div><div>spring-context-4.0.0.RELEASE.jar</div><div>spring-core-4.0.0.RELEASE.jar</div><div>spring-expression-4.0.0.RELEASE.jar</div></div><div><br/></div></div></div><div>                    2）、web模块</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>spring-web-4.0.0.RELEASE.jar</div><div>spring-webmvc-4.0.0.RELEASE.jar</div></div><div><br/></div></div><div>2）、写配置</div><div>     1）、web.xml</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div> &lt;!-- SpringMVC思想是有一个前端控制器能拦截所有请求，并智能派发;</div><div>    这个前端控制器是一个servlet；应该在web.xml中配置这个servlet来拦截所有请求</div><div>   --&gt;</div><div><br/></div><div>   &lt;!-- The front controller of this Spring Web application,</div><div>   responsible for handling all application requests --&gt;</div><div>    &lt;servlet&gt;</div><div>        &lt;servlet-name&gt;springDispatcherServlet&lt;/servlet-name&gt;</div><div>        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div><br/></div><div>        &lt;init-param&gt;</div><div>            &lt;!-- contextConfigLocation:指定SpringMVC配置文件位置 --&gt;</div><div>            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div>            &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;</div><div>        &lt;/init-param&gt;</div><div>        &lt;!-- servlet启动加载，servlet原本是第一次访问创建对象；</div><div>        load-on-startup:服务器启动的时候创建对象；值越小优先级越高，越先创建对象；</div><div>         --&gt;</div><div>        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div>    &lt;/servlet&gt;</div><div><br/></div><div>    &lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</div><div>    &lt;servlet-mapping&gt;</div><div>        &lt;servlet-name&gt;springDispatcherServlet&lt;/servlet-name&gt;</div><div>        &lt;!--</div><div>            /*和/都是拦截所有请求； /：会拦截所有请求，但是不会拦截*.jsp；能保证jsp访问正常；</div><div>            /*的范围更大；还会拦截到*.jsp这些请求；一但拦截jsp页面就不能显示了；</div><div>          --&gt;</div><div>        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</div><div>    &lt;/servlet-mapping&gt;</div></div><div>          2）、SpringMVC配置文件</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!-- 扫描所有组件 --&gt;</div><div>    &lt;context:component-scan base-package=&quot;com.atguigu&quot;&gt;&lt;/context:component-scan&gt;</div><div><br/></div><div>    &lt;!-- 配置一个视图解析器 ；能帮我们拼接页面地址--&gt;</div><div>    &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</div><div>        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;&gt;&lt;/property&gt;</div><div>        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;&gt;&lt;/property&gt;</div><div>    &lt;/bean&gt;</div></div><div><br/></div></div></div><div>3）、测试</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>/**</div><div> * 1、告诉SpringMVC这是一个处理器，可以处理请求</div><div> *      @Controller：标识哪个组件是控制器</div><div> * @author lfy</div><div> *</div><div> */</div><div>@Controller</div><div>public class MyFirstController {</div><div><br/></div><div>    /**</div><div>     *   /代表从当前项目下开始；处理当前项目下的hello请求</div><div>     */</div><div>    @RequestMapping(&quot;/hello&quot;)</div><div>    public String myfirstRequest(){</div><div>        System.out.println(&quot;请求收到了....正在处理中&quot;);</div><div>        //视图解析器自动拼串；</div><div>//      &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;&gt;&lt;/property&gt;</div><div>//      &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;&gt;&lt;/property&gt;</div><div>        //   (前缀)/WEB-INF/pages/+返回值(success)+后缀（.jsp）</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>}</div></div><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3259"/>
<h1>2、SpringMVC-HelloWorld</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/19 11:01</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/19 15:01</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>1、流程</div><div>1）、导包</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>  commons-logging-1.1.3.jar</div><div>spring-aop-4.0.0.RELEASE.jar</div><div>spring-beans-4.0.0.RELEASE.jar</div><div>spring-context-4.0.0.RELEASE.jar</div><div>spring-core-4.0.0.RELEASE.jar</div><div>spring-expression-4.0.0.RELEASE.jar</div><div>spring-web-4.0.0.RELEASE.jar</div><div>spring-webmvc-4.0.0.RELEASE.jar</div></div><div><br/></div></div><div>2）、写配置；</div><div>     1）web.xml可能要写什么</div><div>          配置springmvc的前端控制器，指定springmvc配置文件位置</div><div>         </div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!-- The front controller of this Spring Web application, responsible for</div><div>        handling all application requests --&gt;</div><div>    &lt;servlet&gt;</div><div>        &lt;servlet-name&gt;springDispatcherServlet&lt;/servlet-name&gt;</div><div>        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div>        &lt;init-param&gt;</div><div>            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div>            &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;</div><div>        &lt;/init-param&gt;</div><div>        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div>    &lt;/servlet&gt;</div><div><br/></div><div>    &lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</div><div>    &lt;servlet-mapping&gt;</div><div>        &lt;servlet-name&gt;springDispatcherServlet&lt;/servlet-name&gt;</div><div>        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</div><div>    &lt;/servlet-mapping&gt;</div></div><div><br/></div></div><div><br/></div><div>     2）框架自身可能要写什么</div><div>          
<div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">context:component-scan</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">base-package</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;com.atguigu&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">context:component-scan</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- 视图解析器，可以简化方法的返回值，返回值就是作为目标页面地址，</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        只不过视图解析器可以帮我们拼串</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">bean</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">class</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;prefix&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;/WEB-INF/pages/&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;suffix&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;.jsp&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">bean</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div></div></div><div>3）、测试</div><div><br/></div><div><hr/></div><div>HelloWorld细节：</div><div>一：运行流程；</div><div>          
<div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div> *      1）、客户端点击链接会发送 http://localhost:8080/springmvc/hello 请求</div><div> *      2）、来到tomcat服务器；</div><div> *      3）、SpringMVC的前端控制器收到所有请求；</div><div> *      4）、来看请求地址和@RequestMapping标注的哪个匹配，来找到到底使用那个类的哪个方法来处理</div><div> *      5）、前端控制器找到了目标处理器类和目标方法，直接利用返回执行目标方法；</div><div> *      6）、方法执行完成以后会有一个返回值；SpringMVC认为这个返回值就是要去的页面地址</div><div> *      7）、拿到方法返回值以后；用视图解析器进行拼串得到完整的页面地址；</div><div> *      8）、拿到页面地址，前端控制器帮我们转发到页面；</div></div><div>一个方法处理一个请求；</div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *2、@RequestMapping；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      就是告诉SpringMVC；这个方法用来处理什么请求；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      这个/是可以省略，即使省略了，也是默认从当前项目下开始；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      习惯加上比较好    /hello  /hello</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      RequestMapping的使用：？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *3、如果不指定配置文件位置？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      /WEB</span></font><font color="#7F7F9F" face="Consolas" size="4"><span style="font-size:16pt">-</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">INF/springDispatcherServlet</span></font><font color="#7F7F9F" face="Consolas" size="4"><span style="font-size:16pt">-</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">servlet.xml</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      如果不指定也会默认去找一个文件；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          /WEB</span></font><font color="#7F7F9F" face="Consolas" size="4"><span style="font-size:16pt">-</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">INF/springDispatcherServlet</span></font><font color="#7F7F9F" face="Consolas" size="4"><span style="font-size:16pt">-</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">servlet.xml</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *  就在web应用的/WEB</span></font><font color="#7F7F9F" face="Consolas" size="4"><span style="font-size:16pt">-</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">INF、下创建一个名叫   前端控制器名</span></font><font color="#7F7F9F" face="Consolas" size="4"><span style="font-size:16pt">-</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">servlet.xml</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- </span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        /：拦截所有请求，不拦截</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">页面，*.</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">请求</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        /*：拦截所有请求，拦截</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">页面，*.</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">请求</span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">   </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        </span></font></div></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        处理*.</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">是</span><span style="font-size:16pt"><u>tomcat</u></span><span style="font-size:16pt">做的事；所有项目的小web.xml都是继承于大web.xml</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        DefaultServlet是</span><span style="font-size:16pt"><u>Tomcat</u></span><span style="font-size:16pt">中处理静态资源的？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">            除过</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">，和</span><span style="font-size:16pt"><u>servlet</u></span><span style="font-size:16pt">外剩下的都是静态资源；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">            index.html：静态资源，</span><span style="font-size:16pt"><u>tomcat</u></span><span style="font-size:16pt">就会在服务器下找到这个资源并返回;</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">            我们前端控制器的/禁用了</span><span style="font-size:16pt"><u>tomcat</u></span><span style="font-size:16pt">服务器中的DefaultServlet</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">          </span></font></div></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        </span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        1）服务器的大web.xml中有一个DefaultServlet是</span><span style="font-size:16pt"><u>url</u></span><span style="font-size:16pt">-pattern=/</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        2）我们的配置中前端控制器</span> <span style="font-size:16pt"><u>url</u></span><span style="font-size:16pt">-pattern=/</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">                静态资源会来到DispatcherServlet（前端控制器）看那个方法的RequestMapping是这个index.html</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        3）为什么</span><span style="font-size:16pt"><u>jsp</u></span><span style="font-size:16pt">又能访问；因为我们没有覆盖服务器中的JspServlet的配置</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        4） /*  直接就是拦截所有请求；我们写/；也是为了迎合后来Rest风格的URL地址</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">    --&gt;</span></font></div></div></div></div></div><div><br/></div><div><hr/></div><div>RequestMapping：</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>/**</div><div>     * RequestMapping的其他属性</div><div>     * method：限定请求方式、</div><div>     *      HTTP协议中的所有请求方式：</div><div>     *          【GET】, HEAD, 【POST】, PUT, PATCH, DELETE, OPTIONS, TRACE</div><div>     *      GET、POST</div><div>     *      method=RequestMethod.POST：只接受这种类型的请求，默认是什么都可以；</div><div>     *          不是规定的方式报错：4xx:都是客户端错误</div><div>     *              405 - Request method 'GET' not supported</div><div>     * params：规定请求参数</div><div>     * params 和 headers支持简单的表达式：</div><div>     *      param1: 表示请求必须包含名为 param1 的请求参数</div><div>     *          eg：params={&quot;username&quot;}:</div><div>     *              发送请求的时候必须带上一个名为username的参数；没带都会404</div><div>     *</div><div>     *      !param1: 表示请求不能包含名为 param1 的请求参数</div><div>     *          eg:params={&quot;!username&quot;}</div><div>     *              发送请求的时候必须不携带上一个名为username的参数；带了都会404</div><div>     *      param1 != value1: 表示请求包含名为 param1 的请求参数，但其值不能为 value1</div><div>     *          eg：params={&quot;username!=123&quot;}</div><div>     *              发送请求的时候;携带的username值必须不是123(不带username或者username不是123)</div><div>     *</div><div>     *      {“param1=value1”, “param2”}: 请求必须包含名为 param1 和param2 的两个请求参数，且 param1 参数的值必须为 value1</div><div>     *          eg:params={&quot;username!=123&quot;,&quot;pwd&quot;,&quot;!age&quot;}</div><div>     *              请求参数必须满足以上规则；</div><div>     *              请求的username不能是123，必须有pwd的值，不能有age</div><div>     * headers：规定请求头；也和params一样能写简单的表达式</div><div>     *</div><div>     *</div><div>     *</div><div>     * consumes：只接受内容类型是哪种的请求，规定请求头中的Content-Type</div><div>     * produces：告诉浏览器返回的内容类型是什么，给响应头中加上Content-Type:text/html;charset=utf-8</div><div>     */</div><div>    @RequestMapping(value=&quot;/handle02&quot;,method=RequestMethod.POST)</div><div>    public String handle02(){</div><div>        System.out.println(&quot;handle02...&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     *</div><div>     * @return</div><div>     */</div><div>    @RequestMapping(value=&quot;/handle03&quot;,params={&quot;username!=123&quot;,&quot;pwd&quot;,&quot;!age&quot;})</div><div>    public String handle03(){</div><div>        System.out.println(&quot;handle03....&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     * User-Agent：浏览器信息；</div><div>     * 让火狐能访问，让谷歌不能访问</div><div>     *</div><div>     * 谷歌：</div><div>     * User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36</div><div>     * 火狐;</div><div>     * User-Agent   Mozilla/5.0 (Windows NT 6.3; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0</div><div>     * @return</div><div>     *</div><div>     */</div><div>    @RequestMapping(value=&quot;/handle04&quot;,headers={&quot;User-Agent=Mozilla/5.0 (Windows NT 6.3; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0&quot;})</div><div>    public String handle04(){</div><div>        System.out.println(&quot;handle04....&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *  </span></font><font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@RequestMapping模糊匹配功能</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@author</b></span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"><u>lfy</u></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * URL地址可以写模糊的通配符：</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *  ？：能替代任意一个字符</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *  *：能替代任意多个字符，和一层路径</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *  **：能替代多层路径</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> */</span></font></div><div align="left" style="min-height: 18pt;"><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@Controller</span></font></div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">RequestMappingTest {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/antTest01&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String antTest01(){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;antTest01...&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * ?匹配一个字符,0个多个都不行;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *      模糊和精确多个匹配情况下，精确优先</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@return</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/antTest0?&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String antTest02(){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;antTest02...&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *   *匹配任意多个字符</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@return</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/antTest0*&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String antTest03(){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;antTest03...&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *  *：匹配一层路径</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@return</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/a/*/antTest01&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String antTest04(){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;antTest04...&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/a/**/antTest01&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String antTest05(){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;antTest05...&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//路径上可以有占位符：  占位符 语法就是可以在任意路径的地方写一个{变量名}</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//   /user/</span><span style="font-size:16pt"><u>admin</u></span><span style="font-size:16pt">    /user/</span><span style="font-size:16pt"><u>leifengyang</u></span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// 路径上的占位符只能占一层路径</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/user/{id}&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String pathVariableTest(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@PathVariable</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;id&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)String id){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;路径上的占位符的值&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+id);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3261"/>
<h1>3、Rest</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/19 14:30</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/19 16:16</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>Rest：系统希望以非常简洁的URL地址来发请求；</div><div>          怎样表示对一个资源的增删改查用请求方式来区分</div><div><br/></div><div>/getBook?id=1   ：查询图书</div><div>/deleteBook?id=1：删除1号图书</div><div>/updateBook?id=1:更新1号图书</div><div>/addBook     ：添加图书</div><div><hr/></div><div>Rest推荐；</div><div>     url地址这么起名；  /资源名/资源标识符</div><div>/book/1          ：GET-----查询1号图书</div><div>/book/1          :PUT------更新1号图书</div><div>/book/1          :DELETE-----删除1号图书</div><div>/book               :POST-----添加图书</div><div>系统的URL地址就这么来设计即可；</div><div>     简洁的URL提交请求，以请求方式区分对资源操作；</div><div>问题：从页面上只能发起两种请求，GET、POST；</div><div>其他的请求方式没法使用；</div><div><br/></div><div><hr/></div><div>使用Rest来构建一个增删改查系统；</div><div>页面地址：</div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- 发起图书的增删改查请求；使用Rest风格的URL地址；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">请求</span><span style="font-size:16pt"><u>url</u></span><span style="font-size:16pt">  请求方式 表示含义</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/book/1 GET：   查询1号图书</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/book/1 DELETE：删除1号图书</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/book/1 PUT：   更新1号图书</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/book   POST：  添加1号图书</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">从页面发起PUT、DELETE形式的请求</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> --&gt;</span></font></div><div><span style="font-family: Consolas;"><span style="color: rgb(63, 95, 191);"><br/></span></span></div></div><div><br/></div><div>处理程序：</div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>package com.atguigu.controller;</div><div><br/></div><div>import org.springframework.stereotype.Controller;</div><div>import org.springframework.web.bind.annotation.PathVariable;</div><div>import org.springframework.web.bind.annotation.RequestMapping;</div><div>import org.springframework.web.bind.annotation.RequestMethod;</div><div><br/></div><div>@Controller</div><div>public class BookController {</div><div>    /**</div><div>     * 处理查询图书请求</div><div>     * @param id</div><div>     * @return</div><div>     */</div><div>    @RequestMapping(value=&quot;/book/{bid}&quot;,method=RequestMethod.GET)</div><div>    public String getBook(@PathVariable(&quot;bid&quot;)Integer id) {</div><div>        System.out.println(&quot;查询到了&quot;+id+&quot;号图书&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 图书删除</div><div>     * @param id</div><div>     * @return</div><div>     */</div><div>    @RequestMapping(value=&quot;/book/{bid}&quot;,method=RequestMethod.DELETE)</div><div>    public String deleteBook(@PathVariable(&quot;bid&quot;)Integer id) {</div><div>        System.out.println(&quot;删除了&quot;+id+&quot;号图书&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 图书更新</div><div>     * @return</div><div>     */</div><div>    @RequestMapping(value=&quot;/book/{bid}&quot;,method=RequestMethod.PUT)</div><div>    public String updateBook(@PathVariable(&quot;bid&quot;)Integer id) {</div><div>        System.out.println(&quot;更新了&quot;+id+&quot;号图书&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    @RequestMapping(value=&quot;/book&quot;,method=RequestMethod.POST)</div><div>    public String addBook() {</div><div>        System.out.println(&quot;添加了新的图书&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>}</div></div><div><br/></div></div><div><br/></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</div><div>            throws ServletException, IOException {</div><div>     //获取表单上_method带来的值（delete\put）</div><div>        String paramValue = request.getParameter(this.methodParam);</div><div>     </div><div>     //判断如过表单是一个post而且_method有值</div><div>        if (&quot;POST&quot;.equals(request.getMethod()) &amp;&amp; StringUtils.hasLength(paramValue)) {</div><div>          //转为PUT、DELETE</div><div>            String method = paramValue.toUpperCase(Locale.ENGLISH);</div><div>          //重写了request.getMethod()；</div><div>            HttpServletRequest wrapper = new HttpMethodRequestWrapper(request, method);</div><div><br/></div><div>          //wrapper.getMethod()===PUT；</div><div>            filterChain.doFilter(wrapper, response);</div><div>        }</div><div>        else {</div><div>             //直接放行</div><div>            filterChain.doFilter(request, response);</div><div>        }</div><div>    }</div></div><div><br/></div><div><hr/></div><div><br/></div></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">从页面发起PUT、DELETE形式的请求?Spring提供了对Rest风格的支持</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">1）、SpringMVC中有一个Filter；他可以把普通的请求转化为规定形式的请求；配置这个filter;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;filter&gt;</span></font></div><div align="left" style="min-height: 11pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;</span></font></div><div align="left" style="min-height: 11pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">    &lt;/filter&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">    &lt;filter-mapping&gt;</span></font></div><div align="left" style="min-height: 11pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">    &lt;/filter-mapping&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">2）、如何发其他形式请求？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">    按照以下要求；1、创建一个post类型的表单 2、表单项中携带一个_method的参数，3、这个_method的值就是DELETE、PUT</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">a</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">href</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;book/1&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">查询图书</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">a</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">br</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">form</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">action</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;book&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">method</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;post&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">input</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">type</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;submit&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;添加1号图书&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">form</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">br</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- 发送DELETE请求 --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">form</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">action</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;book/1&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">method</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;post&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">input</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;_method&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;delete&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">input</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">type</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;submit&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;删除1号图书&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">form</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">br</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- 发送PUT请求 --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">form</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">action</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;book/1&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">method</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;post&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">input</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;_method&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;put&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">input</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">type</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;submit&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;更新1号图书&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">form</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">br</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">/&gt;</span></font></div></div><div><br/></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;filter&gt;</div><div>        &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;</div><div>        &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;</div><div>    &lt;/filter&gt;</div><div>    &lt;filter-mapping&gt;</div><div>        &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;</div><div>        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div>    &lt;/filter-mapping&gt;</div></div><div>注意：高版本Tomcat；Rest支持有点问题</div><div><img src="0325_SpringMVC_files/Image [4].png" type="image/png"/></div><div><br/></div><div><br/></div><div>解决方案：</div><div><img src="0325_SpringMVC_files/Image [5].png" type="image/png"/></div></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3267"/>
<h1>4、请求参数</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/19 16:17</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/19 17:16</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>入参处理：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>package com.atguigu.controller;</div><div><br/></div><div>import java.io.BufferedReader;</div><div>import java.io.IOException;</div><div>import java.io.PrintWriter;</div><div><br/></div><div>import javax.servlet.ServletInputStream;</div><div>import javax.servlet.ServletOutputStream;</div><div>import javax.servlet.http.HttpServletRequest;</div><div>import javax.servlet.http.HttpServletResponse;</div><div>import javax.servlet.http.HttpSession;</div><div><br/></div><div>import org.springframework.stereotype.Controller;</div><div>import org.springframework.web.bind.annotation.CookieValue;</div><div>import org.springframework.web.bind.annotation.RequestHeader;</div><div>import org.springframework.web.bind.annotation.RequestMapping;</div><div>import org.springframework.web.bind.annotation.RequestParam;</div><div><br/></div><div>import com.atguigu.book.Book;</div><div><br/></div><div>@Controller</div><div>public class HelloController {</div><div><br/></div><div>    /**</div><div>     * request.getParameter(&quot;&quot;).....</div><div>     *</div><div>     * @return</div><div>     */</div><div>    @RequestMapping(&quot;/hello&quot;)</div><div>    public String handle01() {</div><div>        System.out.println(&quot;handle01...&quot;);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     * SpringMVC如何获取请求带来的各种信息 默认方式获取请求参数： 直接给方法入参上写一个和请求参数名相同的变量。这个变量就来接收请求参数的值；</div><div>     * 带：有值，没带：null；</div><div>     *</div><div>     * @RequestParam：获取请求参数的；参数默认是必须带的；</div><div>     * @RequestParam(&quot;user&quot;)String username username =</div><div>     *                             request.getParameter(&quot;user&quot;)</div><div>     *</div><div>     *</div><div>     * @RequestParam(&quot;user&quot;)</div><div>     * @PathVariable(&quot;user&quot;)</div><div>     *                       /book/【{user}pathvariable】?【user=admin(requestparam)</div><div>     *                       】</div><div>     *</div><div>     *                       value:指定要获取的参数的key required:这个参数是否必须的</div><div>     *                       defaultValue:默认值。没带默认是null；</div><div>     *</div><div>     *</div><div>     * @RequestHeader：获取请求头中某个key的值； request.getHeader(&quot;User-Agent&quot;)；</div><div>     * @RequestHeader(&quot;User-Agent&quot;)String userAgent userAgent =</div><div>     *                                    request.getHeader(&quot;User-Agent&quot;)</div><div>     *                                    如果请求头中没有这个值就会报错； value() required()</div><div>     *                                    defaultValue()</div><div>     *</div><div>     * @CookieValue：获取某个cookie的值； 以前的操作获取某个cookie； Cookie[] cookies =</div><div>     *                            request.getCookies(); for(Cookie c:cookies){</div><div>     *                            if(c.getName().equals(&quot;JSESSIONID&quot;)){ String</div><div>     *                            cv = c.getValue(); } }</div><div>     * value()</div><div>     * required()</div><div>     * defaultValue()</div><div>     */</div><div>    @RequestMapping(&quot;/handle01&quot;)</div><div>    public String handle02(</div><div>            @RequestParam(value = &quot;user&quot;, required = false, defaultValue = &quot;你没带&quot;) String username,</div><div>            @RequestHeader(value = &quot;AHAHA&quot;, required = false, defaultValue = &quot;她也没带&quot;) String userAgent,</div><div>            @CookieValue(value=&quot;JSESSIONID&quot;,required=false)String jid) {</div><div>        System.out.println(&quot;这个变量的值：&quot; + username);</div><div>        System.out.println(&quot;请求头中浏览器的信息：&quot; + userAgent);</div><div>        System.out.println(&quot;cookie中的jid的值&quot;+jid);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     * 如果我们的请求参数是一个POJO；</div><div>     * SpringMVC会自动的为这个POJO进行赋值？</div><div>     * 1）、将POJO中的每一个属性，从request参数中尝试获取出来，并封装即可；</div><div>     * 2）、还可以级联封装；属性的属性</div><div>     * 3）、请求参数的参数名和对象中的属性名一一对应就行</div><div>     *</div><div>     *</div><div>     * 提交的数据可能有乱码：</div><div>     * 请求乱码：</div><div>     *         GET请求：改server.xml；在8080端口处URIEncoding=&quot;UTF-8&quot;</div><div>     *         POST请求：</div><div>     *             在第一次获取请求参数之前设置</div><div>     *             request.setCharacterEncoding(&quot;UTF-8&quot;);</div><div>     *             自己写一个filter；SpringMVC有这个filter</div><div>     *</div><div>     * 响应乱码：</div><div>     *         response.setContentType(&quot;text/html;charset=utf-8&quot;)</div><div>     * @param book</div><div>     * @return</div><div>     */</div><div>    @RequestMapping(&quot;/book&quot;)</div><div>    public String addBook(Book book){</div><div>        System.out.println(&quot;我要保存的图书：&quot;+book);</div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>    /**</div><div>     * SpringMVC可以直接在参数上写原生API;</div><div>     *</div><div>     * HttpServletRequest</div><div>     * HttpServletResponse</div><div>     * HttpSession</div><div>     *</div><div>     *</div><div>     * java.security.Principal</div><div>     * Locale：国际化有关的区域信息对象</div><div>     * InputStream：</div><div>     *         ServletInputStream inputStream = request.getInputStream();</div><div>     * OutputStream：</div><div>     *         ServletOutputStream outputStream = response.getOutputStream();</div><div>     * Reader：</div><div>     *         BufferedReader reader = request.getReader();</div><div>     * Writer：</div><div>     *         PrintWriter writer = response.getWriter();</div><div>     *</div><div>     * @throws IOException</div><div><br/></div><div>     *</div><div>     *</div><div>     */</div><div>    @RequestMapping(&quot;/handle03&quot;)</div><div>    public String handle03(HttpSession session,</div><div>            HttpServletRequest request,HttpServletResponse response) throws IOException {</div><div>        request.setAttribute(&quot;reqParam&quot;, &quot;我是请求域中的&quot;);</div><div>        session.setAttribute(&quot;sessionParam&quot;, &quot;额我是Session域中的&quot;);</div><div><br/></div><div>        return &quot;success&quot;;</div><div>    }</div><div><br/></div><div>}</div></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3269"/>
<h1>5、数据输出</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/20 8:54</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/20 11:03</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>数据输出：如何将数据带给页面；</div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * SpringMVC除过在方法上传入原生的request和session外还能怎么样把数据带给页面</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 1）、可以在方法处传入Map、或者Model或者ModelMap。</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      给这些参数里面保存的所有数据都会放在请求域中。可以在页面获取</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *   关系：</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      Map，Model，ModelMap：最终都是BindingAwareModelMap在工作；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      相当于给BindingAwareModelMap中保存的东西都会被放在请求域中；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      Map(interface(</span><span style="font-size:16pt"><u>jdk</u></span><span style="font-size:16pt">))      Model(interface(spring)) </span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          ||                          //</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          ||                         //</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          \/                        //</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      ModelMap(</span><span style="font-size:16pt"><u>clas</u></span><span style="font-size:16pt">)               //</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                  \\              //</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                   \\            //</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                  ExtendedModelMap</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                          ||</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                          \/</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                  BindingAwareModelMap</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 2）、方法的返回值可以变为ModelAndView类型；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          既包含视图信息（页面地址）也包含模型数据（给页面带的数据）；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          而且数据是放在请求域中；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          request、session、application；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          </span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@author</b></span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"><u>lfy</u></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> */</span></font></div><div align="left" style="min-height: 18pt;"><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@Controller</span></font></div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">OutputController {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/handle01&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String handle01(Map&lt;String, Object&gt; map){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        map.put(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;msg&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">,</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;你好&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;map的类型：&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+map.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * Model：一个接口</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@param</b></span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">model</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@return</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/handle02&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String handle02(Model model){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        model.addAttribute(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;msg&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">,</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;你好坏！&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;model的类型：&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+model.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/handle03&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String handle03(ModelMap modelMap){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        modelMap.addAttribute(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;msg&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">,</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;你好棒！&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;modelmap的类型：&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+modelMap.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 返回值是ModelAndView;可以为页面携带数据</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@return</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/handle04&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ModelAndView handle04(){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//之前的返回值我们就叫视图名；视图名视图解析器是会帮我们最终拼串得到页面的真实地址；</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//ModelAndView</span> <span style="font-size:16pt"><u>mv</u></span> <span style="font-size:16pt">= new ModelAndView(&quot;success&quot;);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        ModelAndView mv =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ModelAndView();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        mv.</span><span style="font-size:16pt; background:#d4d4d4">setViewName</span><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        mv.addObject(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;msg&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">,</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;你好哦！&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">mv;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">}</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div><font face="Consolas"><span style="font-size: 21px;">ModelAttribute：</span></font></div><div><font face="Consolas"><span style="font-size: 21px;">使用场景：</span></font></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;">1）页面：</span></span></div><div><img src="0325_SpringMVC_files/Image [6].png" type="image/png"/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">2）、dao：全字段更新。没带的字段会在数据库中更新为null；</span></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 测试ModelAttribute注解；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 使用场景：书城的图书修改为例；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 1）页面端；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      显示要修改的图书的信息，图书的所有字段都在</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 2）</span><span style="font-size:16pt"><u>servlet</u></span><span style="font-size:16pt">收到修改请求，调用</span><span style="font-size:16pt"><u>dao</u></span><span style="font-size:16pt">；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      String</span> <span style="font-size:16pt"><u>sql</u></span><span style="font-size:16pt">=&quot;update bs_book set title=?,</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                  author=?,price=?,</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *                  sales=?,stock=?,img_path=?</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              where id=?&quot;;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 3）实际场景？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      并不是全字段修改；只会修改部分字段，以修改用户信息为例；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      </span><span style="font-size:16pt"><u>username</u></span><span style="font-size:16pt">  password  address;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      1）、不修改的字段可以在页面进行展示但是不要提供修改输入框；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      2）、为了简单，Controller直接在参数位置来写Book对象</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      3）、SpringMVC为我们自动封装book；（没有带的值是null）</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      4）、如果接下来调用了一个全字段更新的</span><span style="font-size:16pt"><u>dao</u></span><span style="font-size:16pt">操作；会将其他的字段可能变为null；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          </span><span style="font-size:16pt"><u>sql</u></span> <span style="font-size:16pt">= &quot;update bs_book set&quot;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          if(book.getBookName()){</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              </span><span style="font-size:16pt"><u>sql</u></span> <span style="font-size:16pt">+=&quot;bookName=?,&quot;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          }</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          if(book.getPrice()){</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              </span><span style="font-size:16pt"><u>sql</u></span> <span style="font-size:16pt">+=&quot;price=?&quot;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          }</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> * 4）、如何能保证全字段更新的时候，只更新了页面携带的数据；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      1）、修改</span><span style="font-size:16pt"><u>dao</u></span><span style="font-size:16pt">；代价大？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *      2）、Book对象是如何封装的？</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          1）、SpringMVC创建一个book对象，每个属性都有默认值，bookName就是null；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              1、让SpringMVC别创建book对象，直接从数据库中先取出一个id=100的book对象的信息</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              2、Book [id=100, bookName=西游记, author=张三, stock=12, sales=32, price=98.98]</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          2）、将请求中所有与book对应的属性一一设置过来；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              3、使用刚才从数据库取出的book对象，给它 的里面设置值；（请求参数带了哪些值就覆盖之前的值）</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              4、带了的字段就改为携带的值，没带的字段就保持之前的值</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *          3）、调用全字段更新就有问题；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *              5、将之前从数据库中查到的对象，并且封装了请求参数的对象。进行保存；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@author</b></span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"><u>lfy</u></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt"> */</span></font></div><div align="left" style="min-height: 18pt;"><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@Controller</span></font></div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ModelAttributeTestController {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">o1</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">o2</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b1</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b2</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//bookDao.update(book);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//Book [id=100, bookName=null, author=张三, stock=12, sales=32, price=98.98]</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *      String</span> <span style="font-size:16pt"><u>sql</u></span><span style="font-size:16pt">=&quot;update bs_book set bookName=?,</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">                    author=?,price=?,</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">                    sales=?,stock=?,img_path=?</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">                where id=?&quot;;</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 可以告诉SpringMVC不要new这个book了我刚才保存了一个book；</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 哪个就是从数据库中查询出来的；用我这个book?</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;haha&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * </span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 同都是BindingAwareModelMap</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@param</b></span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">book</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@return</b></span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/updateBook&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String updateBook(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;haha&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)Book book,Map&lt;String, Object&gt; model){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">o2</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">= model;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b2</span></font><font face="Consolas" size="4"><span style="font-size:16pt">  = book;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        Object haha = model.get(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;haha&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">//System.out.println(&quot;传入的model：&quot;+model.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;o1==o2?&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+(</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">o1</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">==</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">o2</span></font><font face="Consolas" size="4"><span style="font-size:16pt">));</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;b1==b2?&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+(</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b1</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">==</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b2</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)+</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;--&gt;&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+(</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b2</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">== haha));</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;页面要提交过来的图书信息：&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+book);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;success&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/**</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 1）、SpringMVC要封装请求参数的Book对象不应该是自己new出来的。</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *      而应该是【从数据库中】拿到的准备好的对象</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 2）、再来使用这个对象封装请求参数</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font> <font color="#7F9FBF" face="Consolas" size="4"><span style="font-size:16pt"><b>@ModelAttribute</b></span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">：</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *      参数：取出刚才保存的数据</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *      方法位置：这个方法就会提前于目标方法先运行；</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *          1)我们可以在这里提前查出数据库中图书的信息</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *          2)将这个图书信息保存起来（方便下一个方法还能使用）</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     *</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     * 参数的map：BindingAwareModelMap</span></font></div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     */</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@ModelAttribute</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>void</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">hahaMyModelAttribute(Map&lt;String, Object&gt; map){</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        Book book =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Book(100,</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;西游记&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">,</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;吴承恩&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">, 98, 10, 98.98);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;数据库中查到的图书信息是：&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+book);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        map.put(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;haha&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">, book);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">b1</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">= book;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">o1</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">= map;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        System.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>out</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.println(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;modelAttribute方法...查询了图书并给你保存起来了...他用的map的类型：&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">+map.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">}</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div></div></span>
</div>
<hr>
<a name="3273"/>
<h1>6、SpringMVC源码</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/20 11:43</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/24 10:50</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>1、前端控制器的架构？DispatcherServlet；</div><div>          <img src="0325_SpringMVC_files/Image [7].png" type="image/png" style="height: auto;"/></div><div>2、doDispatch()详细细节：</div><div><br/></div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>protected</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>void</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">doDispatch(HttpServletRequest request, HttpServletResponse response)</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Exception {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        HttpServletRequest processedRequest = request;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        HandlerExecutionChain mappedHandler =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">multipartRequestParsed =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>false</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        WebAsyncManager asyncManager = WebAsyncUtils.</span><span style="font-size:16pt"><i>getAsyncManager</i></span><span style="font-size:16pt">(request);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>try</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            ModelAndView mv =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            Exception dispatchException =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>try</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">               <span style="color: rgb(255, 70, 53);">//1、检查是否文件上传请求</span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(255, 70, 53);"><font face="Consolas" size="4"><span style="font-size:16pt">                processedRequest = checkMultipart(request);</span></font></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                multipartRequestParsed = processedRequest != request;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Determine handler for the current request.</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 95);">              <span style="color: rgb(156, 0, 76);"> //2、根据当前的请求地址找到那个类能来处理；拿到执行链</span></span></span></span></div></div><div align="left" style="min-height: 18pt;"><div><span style="color: rgb(156, 0, 76);"><font face="Consolas" size="4"><span style="font-size:16pt">                mappedHandler = getHandler(processedRequest);</span></font></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">              <span style="color: rgb(227, 0, 0);"> //3、如果没有找到哪个处理器（控制器）能处理这个请求就404，或者抛异常</span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(mappedHandler ==</span></font> <font face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">|| mappedHandler.getHandler() ==</span></font> <font face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></span></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    noHandlerFound(processedRequest, response);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Determine handler adapter for the current request.</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 95);">               <span style="color: rgb(227, 0, 0);">//4、拿到能执行这个类的所有方法的适配器；（反射工具</span></span></span></span><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">AnnotationMethodHandlerAdapter</span></font><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 95);"><span style="color: rgb(227, 0, 0);">）</span></span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span></font></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Process last-modified header, if supported by the handler.</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                String method = request.getMethod();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">isGet =</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;GET&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.equals(method);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(isGet ||</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;HEAD&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.equals(method)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>long</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">logger</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isDebugEnabled()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        String requestUri =</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>urlPathHelper</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.getRequestUri(request);</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">logger</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.debug(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Last-Modified value for [&quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ requestUri +</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;] is: &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ lastModified);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">                 //执行所有拦截器的preHandle<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(!mappedHandler.applyPreHandle(processedRequest, response)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>try</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Actually invoke the handler.处理（控制）器的方法被调用</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 95);">                    //控制器（Controller），处理器（Handler）</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 95);">                    //5、适配器来执行目标方法；将目标方法执行完成后的返回值作为视图名，设置保存到ModelAndView中</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 95);">                    //目标方法无论怎么写，最终适配器执行完成以后都会将执行后的信息封装成ModelAndView<br/></span></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                   <span style="color: rgb(227, 0, 0);"> mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span></span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>finally</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(asyncManager.isConcurrentHandlingStarted()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                applyDefaultViewName(request, mv);//如果没有视图名设置一个默认的视图名；</span></font></div></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                mappedHandler.applyPostHandle(processedRequest, response, mv);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>catch</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Exception ex) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                dispatchException = ex;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">            //转发到目标页面；</span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">            //6、根据方法最终执行完成后封装的ModelAndView；转发到对应页面，而且</span></span><span style="font-size: 16pt;"><span style="font-family: Consolas;">ModelAndView中的数据可以从请求域中获取</span></span></div></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span><span style="color: rgb(227, 0, 0);"><span style="font-size:16pt; background:#d4d4d4">processDispatchResult</span><span style="font-size:16pt">(processedRequest, response, mappedHandler, mv, dispatchException);</span></span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>catch</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Exception ex) {</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>catch</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Error err) {</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            triggerAfterCompletionWithError(processedRequest, response, mappedHandler, err);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>finally</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(asyncManager.isConcurrentHandlingStarted()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Instead of postHandle and afterCompletion</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Clean up any resources used by a multipart request.</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(multipartRequestParsed) {</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                cleanupMultipart(processedRequest);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">1)、所有请求过来DispatcherServlet收到请求，</span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">2）、调用doDispatch()方法进行处理</span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          1）、getHandler()：根据当前请求地址找到能处理这个请求的目标处理器类（处理器）</span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">                    根据当前请求在HandlerMapping中找到这个请求的映射信息，获取到目标处理器类<br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          2）、</span></span><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">getHandlerAdapter()：根据当前处理器类获取到能执行这个处理器方法的适配器；</span></font></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">                   </span> 根据当前处理器类，找到当前类的HandlerAdapter（适配器）<br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">          3）、使用刚才获取到的适配器（</span></span></span><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">AnnotationMethodHandlerAdapter</span></font> <span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">）执行目标方法;</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">          4）、目标方法执行后会返回一个ModelAndView对象</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">          5）、根据</span></span></span><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">ModelAndView的信息转发到具体的页面，并可以在请求域中取出ModelAndView中的模型数据</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);"><br/></span></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">三、</span></span></span><span style="font-size: 16pt;"><span style="font-family: Consolas;">getHandler()细节：怎么根据当前请求就能找到哪个类能来处理</span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">getHandler()会返回目标处理器类的执行链；</span></span></div><div><img src="0325_SpringMVC_files/Image [8].png" type="image/png" style="height: auto;"/>；</div><div><br/></div><div>HandlerMapping：处理器映射：他里面保存了每一个处理器能处理哪些请求的映射信息；</div><div><img src="0325_SpringMVC_files/Image [9].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div>handlerMap：ioc容器启动创建Controller对象的时候扫描每个处理器都能处理什么请求，保存在HandlerMapping的handlerMap属性中；</div><div>下一次请求过来，就来看哪个HandlerMapping中有这个请求映射信息就行了；</div><div><img src="0325_SpringMVC_files/Image [10].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><br/></div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>protected</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">HandlerExecutionChain</span> <span style="font-size:16pt; background:#d4d4d4">getHandler</span><span style="font-size:16pt">(HttpServletRequest request)</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Exception {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae"><b>for</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">(HandlerMapping hm :</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">handlerMappings</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">logger</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isTraceEnabled()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">logger</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.trace(</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Testing handler map [&quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ hm +</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;] in DispatcherServlet with name '&quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ getServletName() +</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;'&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            HandlerExecutionChain handler = hm.getHandler(request);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(handler !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">handler;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><b><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(127, 0, 85);">4、如何找到目标处理器类的适配器。要拿适配器才去执行目标方法</span></span></span></b></div><div><img src="0325_SpringMVC_files/Image [11].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><span style="font-size: 21px;"><b>AnnotationMethodHandlerAdapter</b>：能解析注解方法的适配器；</span></div><div><span style="font-size: 21px;">处理器类中只要有标了注解的这些方法就能用；</span></div><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>protected</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">HandlerAdapter getHandlerAdapter(Object handler)</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ServletException {</span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae"><b>for</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">(HandlerAdapter ha :</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">handlerAdapters</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">logger</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isTraceEnabled()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">logger</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.trace(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Testing handler adapter [&quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ ha +</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;]&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(ha.supports(handler)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ha;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ServletException(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;No adapter for handler [&quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ handler +</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">5、DispatcherServlet中有几个引用类型的属性；SpringMVC的九大组件；</span></span></div><div><font face="Consolas"><span style="font-size: 21px;">SpringMVC在工作的时候，关键位置都是由这些组件完成的；</span></font></div><div><font face="Consolas"><span style="font-size: 21px;">共同点：九大组件全部都是接口；接口就是规范；提供了非常强大的扩展性；</span></font></div><div><font face="Consolas"><span style="font-size: 21px;">SpringMVC的九大组件工作原理；</span></font></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><br/></span></span></div><div align="left" style="min-height: 18pt;"><div><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">     /** 文件上传解析器*/</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">MultipartResolver</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">multipartResolver</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** 区域信息解析器；和国际化有关 */</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">LocaleResolver</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">localeResolver</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** 主题解析器；强大的主题效果更换 */</span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ThemeResolver</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">themeResolver</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** Handler映射信息；</span></font><font face="Consolas" size="4"><span style="font-size:16pt">HandlerMapping</span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">*/</span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">List&lt;HandlerMapping&gt;</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">handlerMappings</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** Handler的适配器 */</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">List&lt;HandlerAdapter&gt;</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">handlerAdapters</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** SpringMVC强大的异常解析功能；异常解析器 */</span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">List&lt;HandlerExceptionResolver&gt;</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">handlerExceptionResolvers</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** </span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">*/</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">RequestToViewNameTranslator</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">viewNameTranslator</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** </span></font><font face="Consolas" size="4"><span style="font-size:16pt">FlashMap+Manager：SpringMVC中运行重定向携带数据的功能</span></font> <font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">*/</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">FlashMapManager</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">flashMapManager</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">/** 视图解析器； */</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">List&lt;ViewResolver&gt;</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">viewResolvers</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div></div></div></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div><font face="Consolas"><span style="font-size: 21px;">DispatcherServlet中九大组件初始化的地方：</span></font></div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>protected void initStrategies(ApplicationContext context) {</div><div>        initMultipartResolver(context);</div><div>        initLocaleResolver(context);</div><div>        initThemeResolver(context);</div><div>        <span style="color: rgb(227, 0, 0);">initHandlerMappings(context);</span></div><div>        <span style="color: rgb(227, 0, 0);">initHandlerAdapters(context);</span></div><div>        initHandlerExceptionResolvers(context);</div><div>        initRequestToViewNameTranslator(context);</div><div>        initViewResolvers(context);</div><div>        initFlashMapManager(context);</div><div>    }</div></div><div><span style="font-size: 16pt;"><br/></span></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>可以在web.xml中修改DispatcherServlet某些属性的默认配置；</div><div>&lt;init-param&gt;</div><div>            &lt;param-name&gt;detectAllHandlerMappings&lt;/param-name&gt;</div><div>            &lt;param-value&gt;false&lt;/param-value&gt;</div><div>        &lt;/init-param&gt;</div></div><div><br/></div></div><div align="left" style="min-height: 18pt;"><div><span style="font-size: 21px;">初始化HandlerMapping</span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>private void initHandlerMappings(ApplicationContext context) {</div><div>        this.handlerMappings = null;</div><div><br/></div><div>        if (this.detectAllHandlerMappings) {</div><div>            // Find all HandlerMappings in the ApplicationContext, including ancestor contexts.</div><div>            Map&lt;String, HandlerMapping&gt; matchingBeans =</div><div>                    BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, true, false);</div><div>            if (!matchingBeans.isEmpty()) {</div><div>                this.handlerMappings = new ArrayList&lt;HandlerMapping&gt;(matchingBeans.values());</div><div>                // We keep HandlerMappings in sorted order.</div><div>                OrderComparator.sort(this.handlerMappings);</div><div>            }</div><div>        }</div><div>        else {</div><div>            try {</div><div>                HandlerMapping hm = context.getBean(HANDLER_MAPPING_BEAN_NAME, HandlerMapping.class);</div><div>                this.handlerMappings = Collections.singletonList(hm);</div><div>            }</div><div>            catch (NoSuchBeanDefinitionException ex) {</div><div>                // Ignore, we'll add a default HandlerMapping later.</div><div>            }</div><div>        }</div><div><br/></div><div>        // Ensure we have at least one HandlerMapping, by registering</div><div>        // a default HandlerMapping if no other mappings are found.</div><div>        if (this.handlerMappings == null) {</div><div>            this.handlerMappings = getDefaultStrategies(context, HandlerMapping.class);</div><div>            if (logger.isDebugEnabled()) {</div><div>                logger.debug(&quot;No HandlerMappings found in servlet '&quot; + getServletName() + &quot;': using default&quot;);</div><div>            }</div><div>        }</div><div>    }</div></div><div><span style="font-size: 21px;">组件的初始化：</span></div><div><span style="font-size: 21px;">     有些组件在容器中是使用类型找的，有些组件是使用id找的；<br/></span></div><div><span style="font-size: 21px;">     去容器中找这个组件，如果没有找到就用默认的配置；</span></div><div><span style="font-size: 21px;"><br/></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String updateBook(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestParam</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(value=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;author&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)String author,</span></font><font face="Consolas" size="4"><span style="font-size:16pt">Map&lt;String, Object&gt; model,</span></font></div><div><font face="Consolas" size="4"><span style="font-size:16pt">                      HttpServletRequest request,</span></font><font face="Consolas" size="4"><span style="font-size:16pt"> </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@</span><span style="font-size:16pt; background:#d4d4d4">ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;haha&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)Book book</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            )</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div></div><div><font face="Consolas" size="4"><span style="font-size:16pt"><span style="color: rgb(227, 0, 0);">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());执行目标方法的细节；</span></span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">     ||</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">     \/<br/></span></span></span></div><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">invokeHandlerMethod(request, response, handler);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(198, 219, 174);">     ||</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(198, 219, 174);">     \/<br/></span></span></span></div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>protected</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ModelAndView invokeHandlerMethod(HttpServletRequest request, HttpServletResponse response, Object handler)</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Exception {</span></font></div></div><div align="left" style="min-height: 18pt;"><div>                           //拿到方法的解析器</div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        ServletHandlerMethodResolver methodResolver = getMethodResolver(handler);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          //方法解析器根据当前请求地址找到真正的目标方法<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        Method handlerMethod = methodResolver.resolveHandlerMethod(request);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          //创建一个方法执行器；<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        ServletHandlerMethodInvoker methodInvoker =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ServletHandlerMethodInvoker(methodResolver);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          //包装原生的</span></span><font face="Consolas" size="4"><span style="font-size:16pt">request, response，</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        ServletWebRequest webRequest =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">ServletWebRequest(request, response);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">        <b><span style="color: rgb(227, 0, 0);">  //创建了一个，隐含模型</span></b></span></span></div></div><div align="left" style="min-height: 18pt;"><b><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">        ExtendedModelMap implicitModel =</span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">new</span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">BindingAwareModelMap();</span></font></span></b></div><div align="left" style="min-height: 18pt;"><div><br/></div></div><div align="left" style="min-height: 18pt;"><div>                         //真正执行目标方法；目标方法利用反射执行期间确定参数值，提前执行modelattribute等所有的操作都在这个方法中；</div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">       <span style="color: rgb(65, 173, 28);"> <b>Object result = methodInvoker.invokeHandlerMethod(handlerMethod, handler, webRequest,</b></span></span> <span style="color: rgb(65, 173, 28);"><b><span style="color: rgb(227, 0, 0);"><span style="font-size:16pt; background:#d4d4d4">implicitModel</span></span><span style="font-size:16pt">);</span></b></span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        ModelAndView mav =</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                methodInvoker.getModelAndView(handlerMethod, handler.getClass(), result,</span> <span style="font-size:16pt; background:#d4d4d4">implicitModel</span><span style="font-size:16pt">, webRequest);</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        methodInvoker.updateModelAttributes(handler, (mav !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">? mav.getModel() :</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">),</span> <span style="font-size:16pt; background:#d4d4d4">implicitModel</span><span style="font-size:16pt">, webRequest);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">mav;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div></div></div></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas"><span style="font-size: 21px;"><b>方法执行的细节</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">invokeHandlerMethod</span></font></div><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>final</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object</span> <span style="font-size:16pt; background:#d4d4d4">invokeHandlerMethod</span><span style="font-size:16pt">(Method handlerMethod, Object handler,</span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            NativeWebRequest webRequest, ExtendedModelMap implicitModel)</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Exception {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">        Method handlerMethodToInvoke = BridgeMethodResolver.</span><span style="font-size:16pt; background:#c6dbae"><i>findBridgedMethod</i></span><span style="font-size:16pt; background:#c6dbae">(handlerMethod);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>try</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">debug =</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>logger</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isDebugEnabled();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>for</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(String attrName :</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">methodResolver</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.getActualSessionAttributeNames()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                Object attrValue =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">sessionAttributeStore</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.retrieveAttribute(webRequest, attrName);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(attrValue !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    implicitModel.addAttribute(attrName, attrValue);</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">               </span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          //找到所有@ModelAttribute注解标注的方法；<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">           <span style="color: rgb(227, 0, 0);"><b> </b></span></span></font><span style="color: rgb(227, 0, 0);"><b><font face="Consolas" size="4"><span style="font-size:16pt">for</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Method attributeMethod :</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">this</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font face="Consolas" size="4"><span style="font-size:16pt">methodResolver</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.getModelAttributeMethods()) {</span></font></b></span></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                Method attributeMethodToInvoke = BridgeMethodResolver.</span><span style="font-size:16pt"><i>findBridgedMethod</i></span><span style="font-size:16pt">(attributeMethod);</span></font></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                //先确定modelattribute方法执行时要使用的每一个参数的值；</span></font></div><div><font face="Consolas" size="4"><span style="font-size:16pt"><span style="color: rgb(227, 0, 0);">               Object[] args = <b><span style="color: rgb(45, 79, 201);">resolveHandlerArguments</span></b>(attributeMethodToInvoke, handler, webRequest, <b><span style="color: rgb(45, 79, 201);">implicitModel</span></b>);</span></span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(debug) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>logger</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.debug(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Invoking model attribute method: &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ attributeMethodToInvoke);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                String attrName = AnnotationUtils.</span><span style="font-size:16pt"><i>findAnnotation</i></span><span style="font-size:16pt">(attributeMethod,</span></font> <font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">).value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(!</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.equals(attrName) &amp;&amp; implicitModel.containsAttribute(attrName)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>continue</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 11pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                ReflectionUtils.</span><span style="font-size:16pt"><i>makeAccessible</i></span><span style="font-size:16pt">(attributeMethodToInvoke);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">               </span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">              <span style="color: rgb(227, 0, 0);"> //提前运行ModelAttribute，</span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                <b>Object attrValue = attributeMethodToInvoke.invoke(handler, args);</b></span></font></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.equals(attrName)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    Class&lt;?&gt; resolvedType = GenericTypeResolver.</span><span style="font-size:16pt"><i>resolveReturnType</i></span><span style="font-size:16pt">(attributeMethodToInvoke, handler.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    attrName = Conventions.</span><span style="font-size:16pt"><i>getVariableNameForReturnType</i></span><span style="font-size:16pt">(attributeMethodToInvoke, resolvedType, attrValue);</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">              <span style="color: rgb(227, 0, 0);">  //把提前运行的ModelAttribute方法的返回值也放在隐含模型中</span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(!implicitModel.containsAttribute(attrName)) {</span></font></span></div><div align="left" style="min-height: 11pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                    implicitModel.addAttribute(attrName, attrValue);</span></font></span></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></span></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">              <span style="color: rgb(227, 0, 0);"> //再次解析目标方法参数是哪些值</span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">            <b>Object[] args = resolveHandlerArguments(handlerMethodToInvoke, handler, webRequest, implicitModel);</b></span></font></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(debug) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>logger</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.debug(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Invoking request handler method: &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ handlerMethodToInvoke);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 11pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            ReflectionUtils.</span><span style="font-size:16pt"><i>makeAccessible</i></span><span style="font-size:16pt">(handlerMethodToInvoke);</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">            <span style="color: rgb(227, 0, 0);">//执行目标方法</span></span></span></div></div><div align="left" style="min-height: 18pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">           <b> </b></span></font><b><font face="Consolas" size="4"><span style="font-size:16pt">return</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">handlerMethodToInvoke.invoke(handler, args);</span></font></b></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>catch</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(IllegalStateException ex) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// Internal assertion failed (e.g. invalid signature):</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// throw exception with full handler method context...</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">HandlerMethodInvocationException(handlerMethodToInvoke, ex);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>catch</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(InvocationTargetException ex) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:16pt">// User-defined @ModelAttribute/@InitBinder/@RequestMapping method threw an exception...</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            ReflectionUtils.</span><span style="font-size:16pt"><i>rethrowException</i></span><span style="font-size:16pt">(ex.getTargetException());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div></div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">public java.lang.String com.atguigu.controller.ModelAttributeTestController.updateBook(</span></font></div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">java.lang.String,</span></font></div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">java.util.Map,</span></font></div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">javax.servlet.http.HttpServletRequest,</span></font></div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">com.atguigu.bean.Book)</span></font></div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas"><span style="font-size: 21px;"><b>确定方法运行时使用的每一个参数的值</b></span></font></div><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt"><span style="color: rgb(45, 79, 201);">Object[]</span> <span style="color: rgb(227, 0, 0);"><b>resolveHandlerArguments</b></span>(Method handlerMethod, Object handler,</span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            NativeWebRequest webRequest, ExtendedModelMap implicitModel)</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Exception {</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        Class&lt;?&gt;[] paramTypes = handlerMethod.getParameterTypes();</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">          //创建了一个和参数个数一样多的数组，会用来保存每一个参数的值<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">        Object[] args =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">Object[paramTypes.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">length</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">];</span></font></div><div align="left" style="min-height: 18pt;"><br/></div><div align="left" style="min-height: 18pt;"><div>                      </div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>for</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>int</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">i = 0; i &lt;</span> <span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">length</span></font><font face="Consolas" size="4"><span style="font-size:16pt">; i++) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            MethodParameter methodParam =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">MethodParameter(handlerMethod, i);</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            methodParam.initParameterNameDiscovery(</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">parameterNameDiscoverer</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            GenericTypeResolver.</span><span style="font-size:16pt"><i>resolveParameterType</i></span><span style="font-size:16pt">(methodParam, handler.getClass());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            String paramName =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            String headerName =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">requestBodyFound =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>false</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            String cookieName =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            String pathVarName =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            String attrName =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">required =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>false</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            String defaultValue =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">validate =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>false</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            Object[] validationHints =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>int</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">annotationsFound = 0;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            Annotation[] paramAnns = methodParam.getParameterAnnotations();</span></font></div><div align="left" style="min-height: 18pt;"><div>                                     <span style="font-size: 21px;"> //找到目标方法这个参数的所有注解，如果有注解就解析并保存注解的信息；</span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>for</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Annotation paramAnn : paramAnns) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestParam</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestParam</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">requestParam = (</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestParam</span></font><font face="Consolas" size="4"><span style="font-size:16pt">) paramAnn;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    paramName = requestParam.value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    required = requestParam.required();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    defaultValue = parseDefaultValueAttribute(requestParam.defaultValue());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    annotationsFound++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestHeader</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestHeader</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">requestHeader = (</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestHeader</span></font><font face="Consolas" size="4"><span style="font-size:16pt">) paramAnn;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    headerName = requestHeader.value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    required = requestHeader.required();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    defaultValue = parseDefaultValueAttribute(requestHeader.defaultValue());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    annotationsFound++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">RequestBody</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    requestBodyFound =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>true</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    annotationsFound++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">CookieValue</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">CookieValue</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">cookieValue = (</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">CookieValue</span></font><font face="Consolas" size="4"><span style="font-size:16pt">) paramAnn;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    cookieName = cookieValue.value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    required = cookieValue.required();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    defaultValue = parseDefaultValueAttribute(cookieValue.defaultValue());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    annotationsFound++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">PathVariable</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">PathVariable</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">pathVar = (</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">PathVariable</span></font><font face="Consolas" size="4"><span style="font-size:16pt">) paramAnn;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    pathVarName = pathVar.value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    annotationsFound++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">ModelAttribute</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">attr = (</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">) paramAnn;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    attrName = attr.value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    annotationsFound++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">Value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isInstance(paramAnn)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    defaultValue = ((</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">Value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">) paramAnn).value();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(paramAnn.annotationType().getSimpleName().startsWith(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Valid&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    validate =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>true</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    Object value = AnnotationUtils.</span><span style="font-size:16pt"><i>getValue</i></span><span style="font-size:16pt">(paramAnn);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    validationHints = (value</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>instanceof</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object[] ? (Object[]) value :</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object[] {value});</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(annotationsFound &gt; 1) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">IllegalStateException(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Handler parameter annotations are exclusive choices - &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;do not specify more than one such annotation on the same parameter: &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ handlerMethod);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><div><br/></div></div><div align="left" style="min-height: 18pt;"><div>                                  <span style="font-size: 21px;"> //没有找到注解的情况；</span></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(annotationsFound == 0) {</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">                //解析普通参数<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">               <span style="color: rgb(255, 0, 0);"> Object argValue = resolveCommonArgument(methodParam, webRequest);--</span></span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">                              会进入resolveStandardArgument（解析标准参数）</span></font></div></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(argValue != WebArgumentResolver.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt"><i>UNRESOLVED</i></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = argValue;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(defaultValue !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolveDefaultValue(defaultValue);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    Class&lt;?&gt; paramType = methodParam.getParameterType();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Model.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isAssignableFrom(paramType) || Map.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isAssignableFrom(paramType)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(!paramType.isAssignableFrom(implicitModel.getClass())) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">IllegalStateException(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Argument [&quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+ paramType.getSimpleName() +</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;] is of type &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                                    </span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Model or Map but is not assignable from the actual model. You may need to switch &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                                    </span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;newer MVC infrastructure classes to use this argument.&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = implicitModel;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(SessionStatus.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isAssignableFrom(paramType)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">sessionStatus</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(HttpEntity.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isAssignableFrom(paramType)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolveHttpEntityRequest(methodParam, webRequest);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(Errors.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isAssignableFrom(paramType)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">IllegalStateException(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;Errors/BindingResult argument declared &quot;</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">+</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                                </span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;without preceding model attribute. Check your handler method signature!&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(BeanUtils.</span><span style="font-size:16pt"><i>isSimpleProperty</i></span><span style="font-size:16pt">(paramType)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        paramName =</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">{</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                        attrName =</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><br/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div>                                      <span style="font-size: 24px;">  //确定值的环节</span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(paramName !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolveRequestParam(paramName, required, defaultValue, methodParam, webRequest, handler);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(headerName !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolveRequestHeader(headerName, required, defaultValue, methodParam, webRequest, handler);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(requestBodyFound) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolveRequestBody(methodParam, webRequest, handler);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(cookieName !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolveCookieValue(cookieName, required, defaultValue, methodParam, webRequest, handler);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(pathVarName !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = resolvePathVariable(pathVarName, methodParam, webRequest, handler);</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">               //确定自定义类型参数的值；还要将请求中的每一个参数赋值给这个对象<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt"><b>else</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(attrName !=</span></font> <font face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(227, 0, 0);">                【POJO对象创建三部曲】<br/></span></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">               <span style="color: rgb(227, 0, 0);"> WebDataBinder binder =</span></span></font></div><div align="left" style="min-height: 11pt;"><span style="color: rgb(227, 0, 0);"><font face="Consolas" size="4"><span style="font-size:16pt">                        resolveModelAttribute(attrName, methodParam, implicitModel, webRequest, handler);</span></font></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>boolean</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">assignBindingResult = (</span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">.</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt">length</span></font> <font face="Consolas" size="4"><span style="font-size:16pt">&gt; i + 1 &amp;&amp; Errors.</span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">.isAssignableFrom(paramTypes[i + 1]));</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(binder.getTarget() !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">                    <span style="color: rgb(255, 0, 0);">【将请求参数中提交的每一个属性和javaBean进行绑定】</span><br/></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    <span style="color: rgb(227, 0, 0);"><b>doBind(binder, webRequest, validate, validationHints, !assignBindingResult);</b></span></span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i] = binder.getTarget();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(assignBindingResult) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">[i + 1] = binder.getBindingResult();</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    i++;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                implicitModel.putAll(binder.getBindingResult().getModel());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">args</span><span style="font-size:16pt">;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    }</span></font></div></div><div><br/></div><div><hr/></div><div><span style="font-size: 21px;">如果没有注解：</span></div><div><span style="font-size: 21px;">     1）、</span><span style="font-size: 21px;">先看是否普通参数（</span><font face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">resolveCommonArgument</span></font><span style="font-size: 21px;">）；----就是确定当前的参数是否是原生API；</span></div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>        protected Object resolveStandardArgument(Class&lt;?&gt; parameterType, NativeWebRequest webRequest) throws Exception {</div><div>            HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);</div><div>            HttpServletResponse response = webRequest.getNativeResponse(HttpServletResponse.class);</div><div><br/></div><div>            if (ServletRequest.class.isAssignableFrom(parameterType) ||</div><div>                    MultipartRequest.class.isAssignableFrom(parameterType)) {</div><div>                Object nativeRequest = webRequest.getNativeRequest(parameterType);</div><div>                if (nativeRequest == null) {</div><div>                    throw new IllegalStateException(</div><div>                            &quot;Current request is not of type [&quot; + parameterType.getName() + &quot;]: &quot; + request);</div><div>                }</div><div>                return nativeRequest;</div><div>            }</div><div>            else if (ServletResponse.class.isAssignableFrom(parameterType)) {</div><div>                this.responseArgumentUsed = true;</div><div>                Object nativeResponse = webRequest.getNativeResponse(parameterType);</div><div>                if (nativeResponse == null) {</div><div>                    throw new IllegalStateException(</div><div>                            &quot;Current response is not of type [&quot; + parameterType.getName() + &quot;]: &quot; + response);</div><div>                }</div><div>                return nativeResponse;</div><div>            }</div><div>            else if (HttpSession.class.isAssignableFrom(parameterType)) {</div><div>                return request.getSession();</div><div>            }</div><div>            else if (Principal.class.isAssignableFrom(parameterType)) {</div><div>                return request.getUserPrincipal();</div><div>            }</div><div>            else if (Locale.class.equals(parameterType)) {</div><div>                return RequestContextUtils.getLocale(request);</div><div>            }</div><div>            else if (InputStream.class.isAssignableFrom(parameterType)) {</div><div>                return request.getInputStream();</div><div>            }</div><div>            else if (Reader.class.isAssignableFrom(parameterType)) {</div><div>                return request.getReader();</div><div>            }</div><div>            else if (OutputStream.class.isAssignableFrom(parameterType)) {</div><div>                this.responseArgumentUsed = true;</div><div>                return response.getOutputStream();</div><div>            }</div><div>            else if (Writer.class.isAssignableFrom(parameterType)) {</div><div>                this.responseArgumentUsed = true;</div><div>                return response.getWriter();</div><div>            }</div><div>            return super.resolveStandardArgument(parameterType, webRequest);</div><div>        }</div></div><div><span style="font-size: 21px;">          2）、判断是否是Model或者是Map旗下的，如果是将之前创建的隐含模型直接赋值给这个参数；</span></div><div><span style="font-size: 21px;"><br/></span></div><div><hr/></div><div><span style="font-size: 21px;">方法上标注的ModelAttribute注解如果有value值   </span></div><div><span style="font-size: 21px;">@ModelAttribute(&quot;abc&quot;)</span></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">hahaMyModelAttribute()</span></font></div></div><div><span style="font-size: 21px;">        标了 ：  attrName=&quot;abc&quot;</span></div><div><span style="font-size: 21px;">        没标：attrName=&quot;&quot;;attrName就会变为返回值类型首字母小写，比如void ,或者book;</span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 21px;">【@ModelAttribute标在方法上的另外一个作用；</span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 21px;">可以把方法运行后的返回值按照方法上</span><span style="font-size: 21px;">@ModelAttribute(&quot;abc&quot;)指定的key放到隐含模型中；</span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 21px;">如果没有指定这个key；就用返回值类型的首字母小写】</span></span></div><div align="left" style="min-height: 18pt;"><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">{haha=Book [id=100, bookName=西游记, author=吴承恩, stock=98, sales=10, price=98.98], void=null}</span></font></div></div></div><div><br/></div><div><hr/></div><div><font size="5">如何确定方法的每一个参数的值；</font></div><div align="left" style="min-height: 18pt;"><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestMapping</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;/updateBook&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">String updateBook(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@RequestParam</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(value=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;author&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)String author,</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            Map&lt;String, Object&gt; model,</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            HttpServletRequest request,</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt">@ModelAttribute</span></font><font face="Consolas" size="4"><span style="font-size:16pt">(</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">&quot;haha&quot;</span></font><font face="Consolas" size="4"><span style="font-size:16pt">)Book book</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">            )</span></font></div></div><div><img src="0325_SpringMVC_files/Image [12].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 21px;">标了注解：</span></div><div><span style="font-size: 21px;">          保存时哪个注解的详细信息；</span></div><div><span style="font-size: 21px;">          如果参数有ModelAttribute注解；</span></div><div><span style="font-size: 21px;">               拿到ModelAttribute注解的值让attrName保存</span></div><div><span style="font-size: 21px;">                    attrName=&quot;haha&quot;<br/></span></div><div><span style="font-size: 21px;">          <br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;">没标注解：</span></div><div><span style="font-size: 21px;">          1）、先看是否普通参数（是否原生API）</span></div><div><span style="font-size: 21px;">               再看是否Model或者Map，如果是就传入隐含模型；</span></div><div><span style="font-size: 21px;">          2）、自定义类型的参数没有</span><span style="font-size: 21px;">ModelAttribute</span> <span style="font-size: 21px;">注解</span></div><div><span style="font-size: 21px;">                    1）、先看是否原生API</span></div><div><span style="font-size: 21px;">                    2）、再看是否Model或者Map</span></div><div><span style="font-size: 21px;">                    3）、再看是否是其他类型的比如</span><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">SessionStatus、</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">HttpEntity、</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">Errors</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);">           4)、再看是否简单类型的属性；比如是否Integer，String，基本类型</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);">                    如果是</span></span></span><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">paramName=“”</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);">           5)、attrName=&quot;&quot;；</span></span></span></div><div><font face="Consolas" size="5">如果是自定义类型对象，最终会产生两个效果；</font></div><div><span style="font-size: 20px;"><span style="font-family: Consolas;">     1）、如果这个参数标注了ModelAttribute注解就给attrName赋值为这个注解的value值</span></span></div><div><span style="font-size: 20px;"><span style="font-family: Consolas;">     2）、如果</span></span><span style="font-size: 20px;"><span style="font-family: Consolas;">这个参数没有标注ModelAttribute注解就给attrName赋值&quot;&quot;；</span></span></div><div><span style="font-size: 20px;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas" size="5"><b>确定自定义类型参数的值；</b></font></div><div><span style="font-size: 20px;"><br/></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>private WebDataBinder resolveModelAttribute(String attrName, MethodParameter methodParam,</div><div>            ExtendedModelMap implicitModel, NativeWebRequest webRequest, Object handler) throws Exception {</div><div><br/></div><div>        // Bind request parameter onto object...  </div><div>        String name = attrName;</div><div>     </div><div>        if (&quot;&quot;.equals(name)) {</div><div>               //如果attrName是空串；就将参数类型的首字母小写作为值  Book book2121;name=book</div><div>            name = Conventions.getVariableNameForParameter(methodParam);</div><div>        }</div><div>        Class&lt;?&gt; paramType = methodParam.getParameterType();</div><div>       <span style="color: rgb(227, 0, 0);"> Object bindObject;确定目标对象的值</span></div><div><span style="color: rgb(227, 0, 0);">        if (implicitModel.containsKey(name)) {</span></div><div><span style="color: rgb(227, 0, 0);">            bindObject = implicitModel.get(name);</span></div><div><span style="color: rgb(227, 0, 0);">        }</span></div><div><span style="color: rgb(227, 0, 0);">        else if (this.methodResolver.isSessionAttribute(name, paramType)) {</span></div><div><span style="color: rgb(227, 0, 0);">            bindObject = this.sessionAttributeStore.retrieveAttribute(webRequest, name);</span></div><div><span style="color: rgb(227, 0, 0);">            if (bindObject == null) {</span></div><div><span style="color: rgb(227, 0, 0);">                raiseSessionRequiredException(&quot;Session attribute '&quot; + name + &quot;' required - not found in session&quot;);</span></div><div><span style="color: rgb(227, 0, 0);">            }</span></div><div><span style="color: rgb(227, 0, 0);">        }</span></div><div><span style="color: rgb(227, 0, 0);">        else {</span></div><div><span style="color: rgb(227, 0, 0);">            bindObject = BeanUtils.instantiateClass(paramType);</span></div><div><span style="color: rgb(227, 0, 0);">        }</span></div><div>        WebDataBinder binder = createBinder(webRequest, bindObject, name);</div><div>        initBinder(handler, name, binder, webRequest);</div><div>        return binder;</div><div>    }</div></div><div><font size="5">SpringMVC确定POJO值的三步；</font></div><div><span style="font-size: 20px;">1、如果隐含模型中有这个key（标了ModelAttribute注解就是注解指定的value，没标就是参数类型的首字母小写）指定的值；</span></div><div><span style="font-size: 20px;">          如果有将这个值赋值给</span><span style="color: rgb(227, 0, 0);">bindObject；</span></div><div><span style="font-size: 20px;">2、如果是SessionAttributes标注的属性，就从session中拿；</span></div><div><span style="font-size: 20px;">3、如果都不是就利用反射创建对象；</span></div><div><span style="font-size: 20px;"><br/></span></div><div><hr/></div><div><font size="5">两件事：</font></div><div><span style="font-size: 20px;">1）、运行流程简单版；</span></div><div><span style="font-size: 20px;">2）、确定方法每个参数的值；</span></div><div><span style="font-size: 20px;">          1）、标注解：保存注解的信息；最终得到这个注解应该对应解析的值；</span></div><div><span style="font-size: 20px;">         </span> <span style="font-size: 20px;">2）、没标注解：</span></div><div><span style="font-size: 20px;">                    1）、看是否是原生API；</span></div><div><span style="font-size: 20px;">                    2）、看是否是Model或者是Map，xxxx</span></div><div><span style="font-size: 20px;">                    3）、都不是，看是否是简单类型；paramName；</span></div><div><span style="font-size: 20px;">                    4）、给attrName赋值；</span><span style="font-size: 20px;">attrName（参数标了@ModelAttribute(&quot;&quot;)就是指定的，没标就是&quot;&quot;）</span></div><div><span style="font-size: 20px;">                              确定自定义类型参数：</span></div><div><span style="font-size: 20px;">                                   1）、</span><span style="font-size: 20px;">attrName使用参数的类型首字母小写；或者使用之前</span><span style="font-size: 20px;">@ModelAttribute(&quot;&quot;)的值</span></div><div><span style="font-size: 20px;">                                   2）、先看隐含模型中有每个这个attrName作为key对应的值；如果有就从隐含模型中获取并赋值</span></div><div><span style="font-size: 20px;">                                   3）、看是否是@SessionAttributes(value=&quot;haha&quot;)；标注的属性，如果是从session中拿；</span></div><div><span style="font-size: 20px;">                                                            如果拿不到就会抛异常；</span></div><div><span style="font-size: 20px;">                                   4）、不是</span><span style="font-size: 20px;">@SessionAttributes标注的，利用反射创建一个对象；</span></div><div><span style="font-size: 20px;">                   5）、拿到之前创建好的对象，使用数据绑定器(WebDataBinder)将请求中的每个数据绑定到这个对象中；<br/></span></div><div><span style="font-size: 20px;"><br/></span></div><div><span style="font-size: 20px;">                    <br/></span></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">  //确定值的环节</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            if (paramName != null) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                args[i] = resolveRequestParam(paramName, required, defaultValue, methodParam, webRequest, handler);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            else if (headerName != null) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                args[i] = resolveRequestHeader(headerName, required, defaultValue, methodParam, webRequest, handler);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            else if (requestBodyFound) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                args[i] = resolveRequestBody(methodParam, webRequest, handler);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            else if (cookieName != null) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                args[i] = resolveCookieValue(cookieName, required, defaultValue, methodParam, webRequest, handler);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            else if (pathVarName != null) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                args[i] = resolvePathVariable(pathVarName, methodParam, webRequest, handler);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">               //确定自定义类型参数的值；还要将请求中的每一个参数赋值给这个对象</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            else if (attrName != null) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                WebDataBinder binder =</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                        resolveModelAttribute(attrName, methodParam, implicitModel, webRequest, handler);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                boolean assignBindingResult = (args.length &gt; i + 1 &amp;&amp; Errors.class.isAssignableFrom(paramTypes[i + 1]));</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                if (binder.getTarget() != null) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                    doBind(binder, webRequest, validate, validationHints, !assignBindingResult);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                args[i] = binder.getTarget();</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                if (assignBindingResult) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                    args[i + 1] = binder.getBindingResult();</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                    i++;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">                implicitModel.putAll(binder.getBindingResult().getModel());</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        return args;</span></span></span></div></div><div><hr/></div><div><br/></div></div><div><span style="font-size: 20px;">       <br/></span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3287"/>
<h1>7、视图解析</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/21 9:14</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/21 14:08</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>SpringMVC视图解析；</div><div>1、方法执行后的返回值会作为页面地址参考，转发或者重定向到页面</div><div>2、视图解析器可能会进行页面地址的拼串；</div><div><br/></div><div><hr/></div><div>1、任何方法的返回值，最终都会被包装成ModelAndView对象</div><div><img src="0325_SpringMVC_files/Image [13].png" type="image/png" style="height: auto;"/></div><div>2、<font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);来到页面的方法</span></font></div><div><font face="Consolas">视图渲染流程：将域中的数据在页面展示；页面就是用来渲染模型数据的；</font></div><div><span style="font-family: Consolas;">3、调用</span><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">render(mv, request, response);渲染页面</span></font></div><div><span style="font-family: Consolas;"><span style="background-color: rgb(198, 219, 174);">4、View与ViewResolver；</span></span></div><div><span style="font-family: Consolas;"><span style="background-color: rgb(198, 219, 174);">     ViewResolver的作用是根据视图名（方法的返回值）得到View对象；</span></span></div><div><img src="0325_SpringMVC_files/Image [14].png" type="image/png" style="height: auto;"/></div><div>5、怎么能根据方法的返回值（视图名）得到View对象？</div><div>     </div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>protected View resolveViewName(String viewName, Map&lt;String, Object&gt; model, Locale locale,</div><div>            HttpServletRequest request) throws Exception {</div><div><br/></div><div>          //遍历所有的ViewResolver；</div><div>        <span style="color: rgb(255, 0, 0);">for (ViewResolver viewResolver : this.viewResolvers) {</span></div><div><span style="color: rgb(255, 0, 0);">          //viewResolver视图解析器根据方法的返回值，得到一个View对象；</span></div><div>            <span style="color: rgb(227, 0, 0);">View view = viewResolver.resolveViewName(viewName, locale);</span></div><div>            if (view != null) {</div><div>                return view;</div><div>            }</div><div>        }</div><div>        return null;</div><div>    }</div></div><div><span style="color: rgb(227, 0, 0);">resolveViewName实现</span></div></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    public View resolveViewName(String viewName, Locale locale) throws Exception {</div><div>        if (!isCache()) {</div><div>            return createView(viewName, locale);</div><div>        }</div><div>        else {</div><div>            Object cacheKey = getCacheKey(viewName, locale);</div><div>            View view = this.viewAccessCache.get(cacheKey);</div><div>            if (view == null) {</div><div>                synchronized (this.viewCreationCache) {</div><div>                    view = this.viewCreationCache.get(cacheKey);</div><div>                    if (view == null) {</div><div>                        // Ask the subclass to create the View object.</div><div>                         //根据方法的返回值创建出视图View对象；</div><div>                       <b><span style="color: rgb(227, 0, 0);"> view</span> = createView(<span style="color: rgb(227, 0, 0);">viewName</span>, locale);</b></div><div>                        if (view == null &amp;&amp; this.cacheUnresolved) {</div><div>                            view = UNRESOLVED_VIEW;</div><div>                        }</div><div>                        if (view != null) {</div><div>                            this.viewAccessCache.put(cacheKey, view);</div><div>                            this.viewCreationCache.put(cacheKey, view);</div><div>                            if (logger.isTraceEnabled()) {</div><div>                                logger.trace(&quot;Cached view [&quot; + cacheKey + &quot;]&quot;);</div><div>                            }</div><div>                        }</div><div>                    }</div><div>                }</div><div>            }</div><div>            return (view != UNRESOLVED_VIEW ? view : null);</div><div>        }</div><div>    }</div></div><div>创建View对象；</div><div><img src="0325_SpringMVC_files/Image [15].png" type="image/png" style="height: auto;"/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    protected <span style="color: rgb(227, 0, 0);"><b>View</b></span> createView(String viewName, Locale locale) throws Exception {</div><div>        // If this resolver is not supposed to handle the given view,</div><div>        // return null to pass on to the next resolver in the chain.</div><div>        if (!canHandle(viewName, locale)) {</div><div>            return null;</div><div>        }</div><div>        // Check for special &quot;redirect:&quot; prefix.</div><div>       <span style="color: rgb(227, 0, 0);"> if (viewName.startsWith(REDIRECT_URL_PREFIX))</span> {</div><div>            String redirectUrl = viewName.substring(REDIRECT_URL_PREFIX.length());</div><div>            <b><span style="color: rgb(255, 0, 0);">RedirectView view = new RedirectView</span></b>(redirectUrl, isRedirectContextRelative(), isRedirectHttp10Compatible());</div><div>            return applyLifecycleMethods(viewName, view);</div><div>        }</div><div>        // Check for special &quot;forward:&quot; prefix.</div><div>        <span style="color: rgb(227, 0, 0);"><b>if (viewName.startsWith(FORWARD_URL_PREFIX)) {</b></span></div><div>            String forwardUrl = viewName.substring(FORWARD_URL_PREFIX.length());</div><div>            return <b><span style="color: rgb(227, 0, 0);">new InternalResourceView(forwardUrl);</span></b></div><div>        }</div><div>        // Else fall back to superclass implementation: calling loadView.</div><div>        //如果没有前缀就使用父类默认创建一个View；</div><div>        <b><span style="color: rgb(227, 0, 0);">return super.createView(viewName, locale);</span></b></div><div>    }</div></div><div><img src="0325_SpringMVC_files/Image [16].png" type="image/png" style="height: auto;"/></div><div><br/></div></div></div><div><img src="0325_SpringMVC_files/Image [17].png" type="image/png" style="height: auto;"/></div><div>返回View对象；</div><div>1、视图解析器得到View对象的流程就是，所有配置的视图解析器都来尝试根据视图名（返回值）得到View（视图）对象；如果能得到就返回，得不到就换下一个视图解析器；</div><div>2、调用View对象的render方法；</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    public void render(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception {</div><div>        if (logger.isTraceEnabled()) {</div><div>            logger.trace(&quot;Rendering view with name '&quot; + this.beanName + &quot;' with model &quot; + model +</div><div>                &quot; and static attributes &quot; + this.staticAttributes);</div><div>        }</div><div><br/></div><div>        Map&lt;String, Object&gt; mergedModel = createMergedOutputModel(model, request, response);</div><div><br/></div><div>        prepareResponse(request, response);</div><div>        <b><span style="color: rgb(227, 0, 0);">//渲染要给页面输出的所有数据</span></b></div><div>        <span style="color: rgb(227, 0, 0);">renderMergedOutputModel(mergedModel, request, response);</span></div><div>    }</div></div><div><br/></div></div><div align="left" style="min-height: 18pt;"><div>InternalResourceView有这个方法renderMergedOutputModel；</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    protected void renderMergedOutputModel(</div><div>            Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception {</div><div><br/></div><div>        // Determine which request handle to expose to the RequestDispatcher.</div><div>        HttpServletRequest requestToExpose = getRequestToExpose(request);</div><div><br/></div><div>        // Expose the model object as request attributes.</div><div>        //将模型中的数据放在请求域中</div><div>        <b><span style="color: rgb(227, 0, 0);">exposeModel</span>As<span style="color: rgb(227, 0, 0);">RequestAttributes</span>(model, requestToExpose);</b></div><div><br/></div><div>        // Expose helpers as request attributes, if any.</div><div>        exposeHelpers(requestToExpose);</div><div><br/></div><div>        // Determine the path for the request dispatcher.</div><div>        String dispatcherPath = prepareForRendering(requestToExpose, response);</div><div><br/></div><div>        // Obtain a RequestDispatcher for the target resource (typically a JSP).</div><div>        RequestDispatcher rd = getRequestDispatcher(requestToExpose, dispatcherPath);</div><div>        if (rd == null) {</div><div>            throw new ServletException(&quot;Could not get RequestDispatcher for [&quot; + getUrl() +</div><div>                    &quot;]: Check that the corresponding file exists within your web application archive!&quot;);</div><div>        }</div><div><br/></div><div>        // If already included or response already committed, perform include, else forward.</div><div>        if (useInclude(requestToExpose, response)) {</div><div>            response.setContentType(getContentType());</div><div>            if (logger.isDebugEnabled()) {</div><div>                logger.debug(&quot;Including resource [&quot; + getUrl() + &quot;] in InternalResourceView '&quot; + getBeanName() + &quot;'&quot;);</div><div>            }</div><div>            rd.include(requestToExpose, response);</div><div>        }</div><div><br/></div><div>        else {</div><div>            // Note: The forwarded resource is supposed to determine the content type itself.</div><div>            if (logger.isDebugEnabled()) {</div><div>                logger.debug(&quot;Forwarding to resource [&quot; + getUrl() + &quot;] in InternalResourceView '&quot; + getBeanName() + &quot;'&quot;);</div><div>            }</div><div>            rd.forward(requestToExpose, response);</div><div>        }</div><div>    }</div></div><div><br/></div><div><br/></div><div align="left" style="min-height: 18pt;"><div>将模型中的所有数据取出来全放在request域中</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>protected void exposeModelAsRequestAttributes(Map&lt;String, Object&gt; model, HttpServletRequest request) throws Exception {</div><div>       <span style="color: rgb(227, 0, 0);"> for (Map.Entry&lt;String, Object&gt; entry : model.entrySet()) {</span></div><div>            String <span style="color: rgb(227, 0, 0);">modelName</span> = entry.getKey();</div><div>            Object <span style="color: rgb(227, 0, 0);">modelValue</span> = entry.getValue();</div><div>            if (modelValue != null) {</div><div>                <span style="color: rgb(227, 0, 0);">request.setAttribute(modelName, modelValue);</span></div><div>                if (logger.isDebugEnabled()) {</div><div>                    logger.debug(&quot;Added model object '&quot; + modelName + &quot;' of type [&quot; + modelValue.getClass().getName() +</div><div>                            &quot;] to request in view with name '&quot; + getBeanName() + &quot;'&quot;);</div><div>                }</div><div>            }</div><div>            else {</div><div>                request.removeAttribute(modelName);</div><div>                if (logger.isDebugEnabled()) {</div><div>                    logger.debug(&quot;Removed model object '&quot; + modelName +</div><div>                            &quot;' from request in view with name '&quot; + getBeanName() + &quot;'&quot;);</div><div>                }</div><div>            }</div><div>        }</div><div>    }</div></div><div><br/></div></div></div><div>一句话：</div><div>视图解析器只是为了得到视图对象；视图对象才能真正的<span style="color: rgb(227, 0, 0);">转发（将模型数据全部放在请求域中）或者重定向到页面</span></div><div>视图对象才能真正的<span style="color: rgb(227, 0, 0);">渲染视图；</span></div><div>ViewResolver;</div><div><img src="0325_SpringMVC_files/Image [18].png" type="image/png" style="height: auto;"/></div><div>View:</div><div><img src="0325_SpringMVC_files/Image [19].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><hr/></div><div>1、导包导入了jstl的时候会自动创建为一个jstlView；可以快速方便的支持国际化功能；</div><div>2、可以支持快速国际化；</div><div>     1）、javaWeb国际化步骤；</div><div>               1）、得得到一个Locale对象；</div><div>               2）、使用ResourceBundle绑定国际化资源文件；</div><div>               3）、使用ResourceBundle.getString(&quot;key&quot;)；获取到国际化配置文件中的值；</div><div>               4）、web页面的国际化，fmt标签库来做；</div><div>                         &lt;fmt:setLocale&gt;</div><div>                         &lt;fmt:setBundle &gt;   </div><div>                         &lt;fmt:message&gt;</div><div>     2）、有了JstlView以后；</div><div>               1）、让Spring管理国际化资源就行</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>    &lt;!--让SpringMVC管理国际化资源文件；配置一个资源文件管理器  --&gt;</div><div>    &lt;bean id=&quot;messageSource&quot; class=&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;&gt;</div><div>        &lt;!--  basename指定基础名--&gt;</div><div>        &lt;property name=&quot;basename&quot; value=&quot;i18n&quot;&gt;&lt;/property&gt;</div><div>    &lt;/bean&gt;</div></div><div><br/></div></div><div>               2）、直接去页面使用&lt;fmt:message&gt;；</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;fmt:message key=&quot;welcomeinfo&quot;/&gt;</div><div>&lt;/h1&gt;</div><div>&lt;form action=&quot;&quot;&gt;</div><div>    &lt;fmt:message key=&quot;username&quot;/&gt;:&lt;input /&gt;&lt;br/&gt;</div><div>    &lt;fmt:message key=&quot;password&quot;/&gt;:&lt;input /&gt;&lt;br/&gt;</div><div>    &lt;input type=&quot;submit&quot; value='&lt;fmt:message key=&quot;loginBtn&quot;/&gt;'/&gt;</div><div>&lt;/form&gt;</div></div><div>一定要过SpringMVC的视图解析流程，人家会创建一个jstlView帮你快速国际化；</div><div>也不能写forward:（</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">if (viewName.startsWith(FORWARD_URL_PREFIX)) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            String forwardUrl = viewName.substring(FORWARD_URL_PREFIX.length());</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            return new InternalResourceView(forwardUrl);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        }</span></span></span></div></div><div>）</div><div><hr/></div><div>扩展：加深视图解析器和视图对象；</div><div>          视图解析器根据方法的返回值得到视图对象；</div><div>          多个视图解析器都会尝试能否得到视图对象；</div><div>          视图对象不同就可以具有不同功能；</div><div><br/></div><div> <span style="color: rgb(255, 0, 0);">for (ViewResolver viewResolver : this.viewResolvers) {</span></div><div><span style="color: rgb(255, 0, 0);">          //viewResolver视图解析器根据方法的返回值，得到一个View对象；</span></div><div>            <span style="color: rgb(227, 0, 0);">View view = viewResolver.resolveViewName(viewName, locale);</span></div><div>            if (view != null) {</div><div>                return view;</div><div>            }</div><div>        }</div><div><br/></div><div><hr/></div><div>1、让我们的视图解析器工作；</div><div>2、得到我们的视图对象</div><div>3、我们的视图对象自定义渲染逻辑</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>response.getWriter().write(&quot;哈哈&lt;h1&gt;即将展现精彩内容&lt;/h1&gt;&quot;);</div></div><div><img src="0325_SpringMVC_files/Image [20].png" type="image/png"/></div><div><br/></div><div><br/></div><div>1、自定义视图和视图解析器的步骤；</div><div>     1）、编写自定义的视图解析器，和视图实现类</div><div>     2）、视图解析器必须放在ioc容器中，让其工作，能创建出我们的自定义视图对象；</div><div><br/></div><div><hr/></div><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3303"/>
<h1>8、SpringMVC-RestfulCRUD</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/21 14:08</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/21 15:54</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>利用SpringMVC做一个CRUD（增删改查）符合Rest风格的；</div><div>C：Create：创建</div><div>R：Retrieve：查询</div><div>U：Update：更新</div><div>D：Delete：删除</div><div>数据库：保存数据；</div><div>使用Map，List保存数据之类</div><div><hr/></div><div>员工列表</div><div><img src="0325_SpringMVC_files/Image [21].png" type="image/png" style="height: auto;"/></div><div><br/></div><div>员工添加：</div><div><img src="0325_SpringMVC_files/Image [22].png" type="image/png" style="height: auto;"/></div><div><br/></div><div>员工修改</div><div><img src="0325_SpringMVC_files/Image [23].png" type="image/png" style="height: auto;"/></div><div>员工删除-点击完成删除来到列表页面</div><div><br/></div><div><hr/></div><div>增删改查的URL地址；       /资源名/资源标识</div><div>/emp/1          GET：查询id为1的员工</div><div>/emp/1          PUT：更新id为1的员工</div><div>/emp/1          DELETE：删除id为1的员工</div><div>/emp             POST：新增员工；</div><div>/emps           GET：查询所有员工</div><div><hr/></div><div>员工列表展示；查询所有员工；</div><div>   员工列表展示：访问index.jsp----直接发送/emps------控制器查询所有员工------放在请求域中-----转发到list页面展示</div><div>     员工添加：</div><div>          在list页面点击“”员工添加“”----（查询出所有的部门信息要展示在页面）----来到添加页面（add.jsp）--------输入员工数据--------点击保存（/emp ）------处理器收到员工保存请求（保存员工）--------保存完成以后还是来到列表页面；</div><div><br/></div><ul><li><span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;; mso-ascii-font-family:&quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;; mso-bidi-font-family:&quot;Arial Unicode MS&quot;;color:black;mso-color-index:1; mso-font-kerning:12.0pt;language:zh-CN;mso-style-textfill-type:solid; mso-style-textfill-fill-themecolor:text1;mso-style-textfill-fill-color:black; mso-style-textfill-fill-alpha:100.0%">通过</span> <span style="font-size:28.0pt; font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family:&quot;Arial Unicode MS&quot;; mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family:&quot;Arial Unicode MS&quot;; color:black;mso-color-index:1;mso-font-kerning:12.0pt;language:en-US; mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor:text1; mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">SpringMVC</span><span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:zh-CN;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">的</span><span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:red;mso-font-kerning:12.0pt;language:zh-CN;font-weight: bold;mso-style-textfill-type:solid;mso-style-textfill-fill-color:red; mso-style-textfill-fill-alpha:100.0%">表单标签</span><span style="font-size:28.0pt; font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family:&quot;Arial Unicode MS&quot;; mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family:&quot;Arial Unicode MS&quot;; color:black;mso-color-index:1;mso-font-kerning:12.0pt;language:zh-CN; mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor:text1; mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">可以实现将模型数据中的属性和</span> <span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:en-US;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">HTML</span> <span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:zh-CN;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">表单元素相绑定，以实现</span><span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:zh-CN;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">表单数据</span><span style="font-size:28.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:red;mso-font-kerning:12.0pt;language:zh-CN;font-weight: bold;mso-style-textfill-type:solid;mso-style-textfill-fill-color:red; mso-style-textfill-fill-alpha:100.0%">更便捷编辑和表单值的回显</span></li></ul><div><br/></div><div><hr/></div><div><br/></div><div><span style="font-size: 19px;">用了表单标签的页面可能会报这个错误；</span></div><div><span style="font-size: 19px;">请求域中没有一个command类型的对象；</span></div><div><span style="font-size: 19px; line-height: 27px;">来到页面之前一定要给请求域中放这个对象；</span></div><div><img src="0325_SpringMVC_files/Image [24].png" type="image/png"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3313"/>
<h1>9、数据转换 &amp; 数据格式化 &amp; 数据校验</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/23 9:24</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/23 16:10</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><ul><li><span style="font-size:20.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:red;mso-font-kerning:12.0pt;language:zh-CN;font-weight: bold;mso-style-textfill-type:solid;mso-style-textfill-fill-color:red; mso-style-textfill-fill-alpha:100.0%">数据转换</span> <span style="font-size:20.0pt; font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family:&quot;Arial Unicode MS&quot;; mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family:&quot;Arial Unicode MS&quot;; color:black;mso-color-index:1;mso-font-kerning:12.0pt;language:en-US; mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor:text1; mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">&amp;</span> <span style="font-size:20.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:zh-CN;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">数据格式</span><span style="font-size:20.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:zh-CN;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">化</span><span style="font-size:20.0pt;font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family: &quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family: &quot;Arial Unicode MS&quot;;color:black;mso-color-index:1;mso-font-kerning:12.0pt; language:en-US;mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor: text1;mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">&amp;</span> <span style="font-size:20.0pt;font-family:&quot;Arial Unicode MS&quot;; mso-ascii-font-family:&quot;Arial Unicode MS&quot;;mso-fareast-font-family:&quot;Arial Unicode MS&quot;; mso-bidi-font-family:&quot;Arial Unicode MS&quot;;color:black;mso-color-index:1; mso-font-kerning:12.0pt;language:zh-CN;mso-style-textfill-type:solid; mso-style-textfill-fill-themecolor:text1;mso-style-textfill-fill-color:black; mso-style-textfill-fill-alpha:100.0%">数据</span><span style="font-size:20.0pt; font-family:&quot;Arial Unicode MS&quot;;mso-ascii-font-family:&quot;Arial Unicode MS&quot;; mso-fareast-font-family:&quot;Arial Unicode MS&quot;;mso-bidi-font-family:&quot;Arial Unicode MS&quot;; color:black;mso-color-index:1;mso-font-kerning:12.0pt;language:zh-CN; mso-style-textfill-type:solid;mso-style-textfill-fill-themecolor:text1; mso-style-textfill-fill-color:black;mso-style-textfill-fill-alpha:100.0%">校验；</span></li></ul><div><font face="Arial Unicode MS" size="6">SpringMVC封装自定义类型对象的时候？</font></div><div><font face="Arial Unicode MS" size="6">javaBean要和页面提交的数据进行一一绑定？</font></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">1）、页面提交的所有数据都是字符串？</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">2）、Integer age,Date birth;</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">          employName=zhangsan&amp;age=18&amp;gender=1</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">          String age = request.getParameter(&quot;age&quot;);<br/></span></span></div><div><font face="Arial Unicode MS" size="6">牵扯到以下操作；</font></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">1）、数据绑定期间的数据类型转换？String--Integer String--Boolean,xxx</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">2）、数据绑定期间的数据格式化问题？比如提交的日期进行转换</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               birth=2017-12-15-----&gt;Date    2017/12/15  2017.12.15  2017-12-15<br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">3）、数据校验？</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               我们提交的数据必须是合法的？</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               前端校验：js+正则表达式；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               后端校验：重要数据也是必须的；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               1）、校验成功！数据合法</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               2）、校验失败？</span></span></div><div><hr/></div><div>新的源码；</div><div>ModelAttributeMethodProcessor</div><div align="left" style="min-height: 18pt;"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>final</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Object resolveArgument(</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            MethodParameter parameter, ModelAndViewContainer mavContainer,</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            NativeWebRequest request, WebDataBinderFactory binderFactory)</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throws</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">Exception {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        String name = ModelFactory.</span><span style="font-size:16pt"><i>getNameForParameter</i></span><span style="font-size:16pt">(parameter);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        Object attribute = (mavContainer.containsAttribute(name)) ?</span></font></div><div align="left" style="min-height: 11pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                mavContainer.getModel().get(name) : createAttribute(name, parameter, binderFactory, request);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        WebDataBinder binder = binderFactory.createBinder(request, attribute, name);</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(binder.getTarget() !=</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>null</b></span></font><font face="Consolas" size="4"><span style="font-size:16pt">) {</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;">               将页面提交过来的数据封装到javaBean的属性中<br/></span></span></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">           <b> bindRequestParameters(binder, request);</b></span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt; background:#c6dbae">            validateIfApplicable(binder, parameter);</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(binder.getBindingResult().hasErrors()) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>if</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">(isBindExceptionRequired(binder, parameter)) {</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                    </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt"><b>new</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt">BindException(binder.getBindingResult());</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                }</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            }</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">        }</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">WebDataBinder：数据绑定器负责数据绑定工作；</span></font></div><div><font face="Consolas"><span style="font-size: 21.33333396911621px;">数据绑定期间产生的类型转换、格式化、数据校验等问题；</span></font></div><div><img src="0325_SpringMVC_files/Image [25].png" type="image/png" style="height: auto;"/></div><div>ConversionService组件：负责数据类型的转换以及格式化功能；</div><div>          ConversionService中有非常多的<b>converter；</b></div><div>          不同类型的转换和格式化用它自己的<b>converter</b></div></div></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b>ConversionService converters =</b></div><div>    @org.springframework.format.annotation.DateTimeFormat java.lang.Long -&gt; java.lang.String: org.springframework.format.datetime.<b>DateTimeFormatAnnotationFormatterFactory</b>@32abc654,@org.springframework.format.annotation.NumberFormat java.lang.Long -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    @org.springframework.format.annotation.DateTimeFormat java.time.LocalDate -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.time.LocalDate -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@edd23ab</div><div>    @org.springframework.format.annotation.DateTimeFormat java.time.LocalDateTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.time.LocalDateTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@4f10103d</div><div>    @org.springframework.format.annotation.DateTimeFormat java.time.LocalTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.time.LocalTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@2b482406</div><div>    @org.springframework.format.annotation.DateTimeFormat java.time.OffsetDateTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.time.OffsetDateTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@5bff2a4e</div><div>    @org.springframework.format.annotation.DateTimeFormat java.time.OffsetTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.time.OffsetTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@220f2940</div><div>    @org.springframework.format.annotation.DateTimeFormat java.time.ZonedDateTime -&gt; java.lang.String: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.time.ZonedDateTime -&gt; java.lang.String : org.springframework.format.datetime.standard.TemporalAccessorPrinter@174673c</div><div>    @org.springframework.format.annotation.DateTimeFormat java.util.Calendar -&gt; java.lang.String: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@32abc654</div><div>    @org.springframework.format.annotation.<b>DateTimeFormat</b> java.util.Date -&gt; java.lang.String: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@32abc654</div><div>    @org.springframework.format.annotation.NumberFormat java.lang.Double -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    @org.springframework.format.annotation.<b>NumberFormat</b> java.lang.Float -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    @org.springframework.format.annotation.NumberFormat java.lang.Integer -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    @org.springframework.format.annotation.NumberFormat java.lang.Short -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    @org.springframework.format.annotation.NumberFormat java.math.BigDecimal -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    @org.springframework.format.annotation.NumberFormat java.math.BigInteger -&gt; java.lang.String: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.Boolean -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@67fe49bf</div><div>    java.lang.Character -&gt; java.lang.Number : org.springframework.core.convert.support.CharacterToNumberFactory@5184d61b</div><div>    java.lang.Character -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@6a45e172</div><div>    java.lang.Enum -&gt; java.lang.String : org.springframework.core.convert.support.EnumToStringConverter@64048fc3</div><div>    java.lang.Long -&gt; java.util.Calendar : org.springframework.format.datetime.DateFormatterRegistrar$LongToCalendarConverter@37cbfe30</div><div>    java.lang.Long -&gt; java.util.Date : org.springframework.format.datetime.DateFormatterRegistrar$LongToDateConverter@79fc7df4</div><div>    java.lang.Number -&gt; java.lang.Character : org.springframework.core.convert.support.NumberToCharacterConverter@6d7337c1</div><div>    java.lang.Number -&gt; java.lang.Number : org.springframework.core.convert.support.NumberToNumberConverterFactory@6e0b7bd8</div><div>    java.lang.Number -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@1135afc3</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.lang.Long: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@32abc654,java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Long: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.LocalDate: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.lang.String -&gt; java.time.LocalDate: org.springframework.format.datetime.standard.TemporalAccessorParser@6228dd42</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.LocalDateTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.lang.String -&gt; java.time.LocalDateTime: org.springframework.format.datetime.standard.TemporalAccessorParser@6bf61650</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.LocalTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.lang.String -&gt; java.time.LocalTime: org.springframework.format.datetime.standard.TemporalAccessorParser@2837beeb</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.OffsetDateTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.lang.String -&gt; java.time.OffsetDateTime: org.springframework.format.datetime.standard.TemporalAccessorParser@60f3f7</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.OffsetTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.lang.String -&gt; java.time.OffsetTime: org.springframework.format.datetime.standard.TemporalAccessorParser@3cb8bdb7</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.time.ZonedDateTime: org.springframework.format.datetime.standard.Jsr310DateTimeFormatAnnotationFormatterFactory@39274b77,java.lang.String -&gt; java.time.ZonedDateTime: org.springframework.format.datetime.standard.TemporalAccessorParser@14a1511f</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.util.Calendar: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@32abc654</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.DateTimeFormat java.util.Date: org.springframework.format.datetime.DateTimeFormatAnnotationFormatterFactory@32abc654</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Double: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Float: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Integer: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.lang.Short: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.math.BigDecimal: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    java.lang.String -&gt; @org.springframework.format.annotation.NumberFormat java.math.BigInteger: org.springframework.format.number.NumberFormatAnnotationFormatterFactory@140bb45d</div><div>    <b>java.lang.String -&gt; java.lang.Boolean</b> : org.springframework.core.convert.support.<b>StringToBooleanConverter</b>@22f562e2</div><div>   <b> java.lang.String -&gt; java.lang.Character</b> : org.springframework.core.convert.support.StringToCharacterConverter@5f2594f5</div><div>    <b>java.lang.String -&gt; java.lang.Enum</b> : org.springframework.core.convert.support.StringToEnumConverterFactory@1347a7be</div><div>    【<b>java.lang.String -&gt; java.lang.Number</b> : org.springframework.core.convert.support.<b>StringToNumberConverterFactory</b>@28a5e291】</div><div>    java.lang.String -&gt; java.time.Instant: org.springframework.format.datetime.standard.InstantFormatter@1eb74d34</div><div>    java.lang.String -&gt; java.util.Locale : org.springframework.core.convert.support.<b>StringToLocaleConverter</b>@6def03d3</div><div>    java.lang.String -&gt; java.util.Properties : org.springframework.core.convert.support.StringToPropertiesConverter@569d2e80</div><div>    java.lang.String -&gt; java.util.UUID : org.springframework.core.convert.support.StringToUUIDConverter@343b18b</div><div>    java.time.Instant -&gt; java.lang.String : org.springframework.format.datetime.standard.InstantFormatter@1eb74d34</div><div>    java.time.ZoneId -&gt; java.util.TimeZone : org.springframework.core.convert.support.ZoneIdToTimeZoneConverter@63b3b722</div><div>    java.util.Calendar -&gt; java.lang.Long : org.springframework.format.datetime.DateFormatterRegistrar$CalendarToLongConverter@1f07f950</div><div>    java.util.Calendar -&gt; java.util.Date : org.springframework.format.datetime.DateFormatterRegistrar$CalendarToDateConverter@3bfdcdf6</div><div>    java.util.Date -&gt; java.lang.Long : org.springframework.format.datetime.DateFormatterRegistrar$DateToLongConverter@19cfea5e</div><div>    java...</div></div><div><br/></div><div><hr/></div></div><div><img src="0325_SpringMVC_files/Image [26].png" type="image/png" style="height: auto;"/></div><div>validators负责数据校验工作；</div><div><br/></div><div><hr/></div><div><img src="0325_SpringMVC_files/Image [27].png" type="image/png" style="height: auto;"/></div><div>bindingResult负责保存以及解析数据绑定期间数据校验产生的错误；</div><div><br/></div><div><hr/></div><div><img src="0325_SpringMVC_files/Image [28].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><hr/></div><div>1、自定义类型转换；</div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     1)、步骤；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">          ConversionService:：是一个接口；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               它里面有Converter（转换器）进行工作：</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">               </span></span><img src="0325_SpringMVC_files/Image [29].png" type="image/png" style="height: auto;"/></div><div>               </div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">         </span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">          2)、</span></span><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">Converter是ConversionService中的组件；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">                    1、你的Converter得放进</span></span><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">ConversionService</span></span> <span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">中；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">                    2、将WebDataBinder中的ConversionService设置成我们这个加了自定义类型转换器的</span></span><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">ConversionService；</span></span></div><div><font face="Arial Unicode MS" size="6">需要写的步骤</font></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">          1 )、实现Converter接口，写一个自定义的类型转换器；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">          3）、配置出</span></span><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">ConversionService；</span></span></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><br/></div><div><br/></div><div>    &lt;!-- 告诉SpringMVC别用默认的ConversionService，</div><div>            而用我自定义的ConversionService、可能有我们自定义的Converter； --&gt;</div><div>    &lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;&gt;</div><div>        &lt;!--converters转换器中添加我们自定义的类型转换器  --&gt;</div><div>        &lt;property name=&quot;converters&quot;&gt;</div><div>            &lt;set&gt;</div><div>                &lt;bean class=&quot;com.atguigu.component.MyStringToEmployeeConverter&quot;&gt;&lt;/bean&gt;</div><div>            &lt;/set&gt;</div><div>        &lt;/property&gt;</div><div>    &lt;/bean&gt;</div></div><div>                              4)、让SpringMVC用我们的ConversionService；</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!-- conversion-service=&quot;conversionService&quot;：使用我们自己配置的类型转换组件 --&gt;</div><div>    &lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;&gt;&lt;/mvc:annotation-driven&gt;</div></div><div><br/></div><div><hr/></div><div>总结三步：</div><div>     1）、实现Converter接口，做一个自定义类型的转换器</div><div>     2）、将这个Converter配置在ConversionService中</div><div>               </div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!-- 告诉SpringMVC别用默认的ConversionService，</div><div>            而用我自定义的ConversionService、可能有我们自定义的Converter； --&gt;</div><div>    &lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;&gt;</div><div>        &lt;!--converters转换器中添加我们自定义的类型转换器  --&gt;</div><div>        &lt;property name=&quot;converters&quot;&gt;</div><div>            &lt;set&gt;</div><div>                &lt;bean class=&quot;com.atguigu.component.MyStringToEmployeeConverter&quot;&gt;&lt;/bean&gt;</div><div>            &lt;/set&gt;</div><div>        &lt;/property&gt;</div><div>    &lt;/bean&gt;</div></div><div>     3）、告诉SpringNMVC使用这个ConversionService</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!-- conversion-service=&quot;conversionService&quot;：使用我们自己配置的类型转换组件 --&gt;</div><div>    &lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;&gt;&lt;/mvc:annotation-driven&gt;</div></div><div>          4）、源码上WebDataBinder上的ConversionService组件就替换了；</div><div><img src="0325_SpringMVC_files/Image [30].png" type="image/png" style="height: auto;"/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>ConversionService converters =</div><div>    java.lang.Boolean -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@47d21368</div><div>    java.lang.Character -&gt; java.lang.Number : org.springframework.core.convert.support.CharacterToNumberFactory@3cdad94b</div><div>    java.lang.Character -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@2a65d058</div><div>    java.lang.Enum -&gt; java.lang.String : org.springframework.core.convert.support.EnumToStringConverter@5b63b99f</div><div>    java.lang.Number -&gt; java.lang.Character : org.springframework.core.convert.support.NumberToCharacterConverter@1fee86c</div><div>    java.lang.Number -&gt; java.lang.Number : org.springframework.core.convert.support.NumberToNumberConverterFactory@281e80cc</div><div>    java.lang.Number -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@7cd83820</div><div>    <span style="color: rgb(227, 0, 0);"><b>java.lang.String -&gt; com.atguigu.bean.Employee : com.atguigu.component.MyStringToEmployeeConverter@3dc22c7a</b></span></div><div>    java.lang.String -&gt; java.lang.Boolean : org.springframework.core.convert.support.StringToBooleanConverter@4331ec46</div><div>    java.lang.String -&gt; java.lang.Character : org.springframework.core.convert.support.StringToCharacterConverter@76a136a0</div><div>    java.lang.String -&gt; java.lang.Enum : org.springframework.core.convert.support.StringToEnumConverterFactory@31192e76</div><div>    java.lang.String -&gt; java.lang.Number : org.springframework.core.convert.support.StringToNumberConverterFactory@761ba575</div><div>    java.lang.String -&gt; java.util.Locale : org.springframework.core.convert.support.StringToLocaleConverter@17fc3d69</div><div>    java.lang.String -&gt; java.util.Properties : org.springframework.core.convert.support.StringToPropertiesConverter@38f0c949</div><div>    java.lang.String -&gt; java.util.UUID : org.springframework.core.convert.support.StringToUUIDConverter@8784d56</div><div>    java.time.ZoneId -&gt; java.util.TimeZone : org.springframework.core.convert.support.ZoneIdToTimeZoneConverter@c0a6ab8</div><div>    java.util.Locale -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@406235ad</div><div>    java.util.Properties -&gt; java.lang.String : org.springframework.core.convert.support.PropertiesToStringConverter@7e193089</div><div>    java.util.TimeZone -&gt; java.time.ZoneId : org.springframework.core.convert.support.TimeZoneToZoneIdConverter@463abd52</div><div>    java.util.UUID -&gt; java.lang.String : org.springframework.core.convert.support.ObjectToStringConverter@59e6cea9</div><div>    org.springframework.core.convert.support.ArrayToArrayConverter@1a90e2f2</div><div>    org.springframework.core.convert.support.ArrayToCollectionConverter@6762ee5d</div><div>    org.springframework.core.convert.support.ArrayToObjectConverter@1aae2bbf</div><div>    org.springframework.core.convert.support.ArrayToStringConverter@15ee899f</div><div>    org.springframework.core.convert.support.ByteBufferConverter@2609c195</div><div>    org.springframework.core.convert.support.ByteBufferConverter@2609c195</div><div>    org.springframework.core.convert.support.CollectionToArrayConverter@50c81740</div><div>    org.springframework.core.convert.support.CollectionToCollectionConverter@75ece48f</div><div>    org.springframework.core.convert.support.CollectionToObjectConverter@59d26508</div><div>    org.springframework.core.convert.support.CollectionToStringConverter@1960bfcd</div><div>    org.springframework.core.convert.support.FallbackObjectToStringConverter@1137fd96</div><div>    org.springframework.core.convert.support.IdToEntityConverter@6a196118,org.springframework.core.convert.support.ObjectToObjectConverter@27400a7</div><div>    org.springframework.core.convert.support.MapToMapConverter@50cfc69</div><div>    org.springframework.core.convert.support.ObjectToArrayConverter@78a37337</div><div>    org.springframework.core.convert.support.ObjectToCollectionConverter@3a0b9fce</div><div>    org.springframework.core.convert.support.StringToArrayConverter@8747ea2</div><div>    org.springframework.core.convert.support.StringToCollectionConverter@324a432d</div></div><div><br/></div></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">mvc:annotation-driven</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">mvc:annotation-driven</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&gt;</span></font></div><div><img src="0325_SpringMVC_files/Image [31].png" type="image/png" style="height: auto;"/></div><div><br/></div><div>SpringMVC解析<font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">mvc:annotation-driven表签到底做了哪些事情？</span></font></div><div><br/></div><div>解析这个标签添了好多东西；</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class AnnotationDrivenBeanDefinitionParser implements BeanDefinitionParser {</div><div><br/></div><div>    private static final boolean jsr303Present = ClassUtils.isPresent(</div><div>            &quot;javax.validation.Validator&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader());</div><div><br/></div><div>    private static final boolean jaxb2Present =</div><div>            ClassUtils.isPresent(&quot;javax.xml.bind.Binder&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader());</div><div><br/></div><div>    private static final boolean jackson2Present =</div><div>            ClassUtils.isPresent(&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader()) &amp;&amp;</div><div>                    ClassUtils.isPresent(&quot;com.fasterxml.jackson.core.JsonGenerator&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader());</div><div><br/></div><div>    private static final boolean jacksonPresent =</div><div>            ClassUtils.isPresent(&quot;org.codehaus.jackson.map.ObjectMapper&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader()) &amp;&amp;</div><div>                    ClassUtils.isPresent(&quot;org.codehaus.jackson.JsonGenerator&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader());</div><div><br/></div><div>    private static boolean romePresent =</div><div>            ClassUtils.isPresent(&quot;com.sun.syndication.feed.WireFeed&quot;, AnnotationDrivenBeanDefinitionParser.class.getClassLoader());</div><div><br/></div><div>    @Override</div><div>    public BeanDefinition parse(Element element, ParserContext parserContext) {</div><div>        Object source = parserContext.extractSource(element);</div><div><br/></div><div>        CompositeComponentDefinition compDefinition = new CompositeComponentDefinition(element.getTagName(), source);</div><div>        parserContext.pushContainingComponent(compDefinition);</div><div><br/></div><div>        RuntimeBeanReference contentNegotiationManager = getContentNegotiationManager(element, source, parserContext);</div><div><br/></div><div>        RootBeanDefinition handlerMappingDef = new RootBeanDefinition(RequestMappingHandlerMapping.class);</div><div>        handlerMappingDef.setSource(source);</div><div>        handlerMappingDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        handlerMappingDef.getPropertyValues().add(&quot;order&quot;, 0);</div><div>        handlerMappingDef.getPropertyValues().add(&quot;contentNegotiationManager&quot;, contentNegotiationManager);</div><div>        String methodMappingName = parserContext.getReaderContext().registerWithGeneratedName(handlerMappingDef);</div><div>        if (element.hasAttribute(&quot;enable-matrix-variables&quot;) || element.hasAttribute(&quot;enableMatrixVariables&quot;)) {</div><div>            Boolean enableMatrixVariables = Boolean.valueOf(element.getAttribute(</div><div>                    element.hasAttribute(&quot;enable-matrix-variables&quot;) ? &quot;enable-matrix-variables&quot; : &quot;enableMatrixVariables&quot;));</div><div>            handlerMappingDef.getPropertyValues().add(&quot;removeSemicolonContent&quot;, !enableMatrixVariables);</div><div>        }</div><div><br/></div><div>        RuntimeBeanReference conversionService = getConversionService(element, source, parserContext);</div><div>        RuntimeBeanReference validator = getValidator(element, source, parserContext);</div><div>        RuntimeBeanReference messageCodesResolver = getMessageCodesResolver(element, source, parserContext);</div><div><br/></div><div>        RootBeanDefinition bindingDef = new RootBeanDefinition(ConfigurableWebBindingInitializer.class);</div><div>        bindingDef.setSource(source);</div><div>        bindingDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        bindingDef.getPropertyValues().add(&quot;conversionService&quot;, conversionService);</div><div>        bindingDef.getPropertyValues().add(&quot;validator&quot;, validator);</div><div>        bindingDef.getPropertyValues().add(&quot;messageCodesResolver&quot;, messageCodesResolver);</div><div><br/></div><div>        ManagedList&lt;?&gt; messageConverters = getMessageConverters(element, source, parserContext);</div><div>        ManagedList&lt;?&gt; argumentResolvers = getArgumentResolvers(element, source, parserContext);</div><div>        ManagedList&lt;?&gt; returnValueHandlers = getReturnValueHandlers(element, source, parserContext);</div><div>        String asyncTimeout = getAsyncTimeout(element, source, parserContext);</div><div>        RuntimeBeanReference asyncExecutor = getAsyncExecutor(element, source, parserContext);</div><div>        ManagedList&lt;?&gt; callableInterceptors = getCallableInterceptors(element, source, parserContext);</div><div>        ManagedList&lt;?&gt; deferredResultInterceptors = getDeferredResultInterceptors(element, source, parserContext);</div><div><br/></div><div>        RootBeanDefinition handlerAdapterDef = new RootBeanDefinition(RequestMappingHandlerAdapter.class);</div><div>        handlerAdapterDef.setSource(source);</div><div>        handlerAdapterDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        handlerAdapterDef.getPropertyValues().add(&quot;contentNegotiationManager&quot;, contentNegotiationManager);</div><div>        handlerAdapterDef.getPropertyValues().add(&quot;webBindingInitializer&quot;, bindingDef);</div><div>        handlerAdapterDef.getPropertyValues().add(&quot;messageConverters&quot;, messageConverters);</div><div>        if (element.hasAttribute(&quot;ignore-default-model-on-redirect&quot;) || element.hasAttribute(&quot;ignoreDefaultModelOnRedirect&quot;)) {</div><div>            Boolean ignoreDefaultModel = Boolean.valueOf(element.getAttribute(</div><div>                    element.hasAttribute(&quot;ignore-default-model-on-redirect&quot;) ? &quot;ignore-default-model-on-redirect&quot; : &quot;ignoreDefaultModelOnRedirect&quot;));</div><div>            handlerAdapterDef.getPropertyValues().add(&quot;ignoreDefaultModelOnRedirect&quot;, ignoreDefaultModel);</div><div>        }</div><div>        if (argumentResolvers != null) {</div><div>            handlerAdapterDef.getPropertyValues().add(&quot;customArgumentResolvers&quot;, argumentResolvers);</div><div>        }</div><div>        if (returnValueHandlers != null) {</div><div>            handlerAdapterDef.getPropertyValues().add(&quot;customReturnValueHandlers&quot;, returnValueHandlers);</div><div>        }</div><div>        if (asyncTimeout != null) {</div><div>            handlerAdapterDef.getPropertyValues().add(&quot;asyncRequestTimeout&quot;, asyncTimeout);</div><div>        }</div><div>        if (asyncExecutor != null) {</div><div>            handlerAdapterDef.getPropertyValues().add(&quot;taskExecutor&quot;, asyncExecutor);</div><div>        }</div><div>        handlerAdapterDef.getPropertyValues().add(&quot;callableInterceptors&quot;, callableInterceptors);</div><div>        handlerAdapterDef.getPropertyValues().add(&quot;deferredResultInterceptors&quot;, deferredResultInterceptors);</div><div>        String handlerAdapterName = parserContext.getReaderContext().registerWithGeneratedName(handlerAdapterDef);</div><div><br/></div><div>        String uriCompContribName = MvcUriComponentsBuilder.MVC_URI_COMPONENTS_CONTRIBUTOR_BEAN_NAME;</div><div>        RootBeanDefinition uriCompContribDef = new RootBeanDefinition(CompositeUriComponentsContributorFactoryBean.class);</div><div>        uriCompContribDef.setSource(source);</div><div>        uriCompContribDef.getPropertyValues().addPropertyValue(&quot;handlerAdapter&quot;, handlerAdapterDef);</div><div>        uriCompContribDef.getPropertyValues().addPropertyValue(&quot;conversionService&quot;, conversionService);</div><div>        parserContext.getReaderContext().getRegistry().registerBeanDefinition(uriCompContribName, uriCompContribDef);</div><div><br/></div><div>        RootBeanDefinition csInterceptorDef = new RootBeanDefinition(ConversionServiceExposingInterceptor.class);</div><div>        csInterceptorDef.setSource(source);</div><div>        csInterceptorDef.getConstructorArgumentValues().addIndexedArgumentValue(0, conversionService);</div><div>        RootBeanDefinition mappedCsInterceptorDef = new RootBeanDefinition(MappedInterceptor.class);</div><div>        mappedCsInterceptorDef.setSource(source);</div><div>        mappedCsInterceptorDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        mappedCsInterceptorDef.getConstructorArgumentValues().addIndexedArgumentValue(0, (Object) null);</div><div>        mappedCsInterceptorDef.getConstructorArgumentValues().addIndexedArgumentValue(1, csInterceptorDef);</div><div>        String mappedInterceptorName = parserContext.getReaderContext().registerWithGeneratedName(mappedCsInterceptorDef);</div><div><br/></div><div>        RootBeanDefinition exceptionHandlerExceptionResolver = new RootBeanDefinition(ExceptionHandlerExceptionResolver.class);</div><div>        exceptionHandlerExceptionResolver.setSource(source);</div><div>        exceptionHandlerExceptionResolver.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        exceptionHandlerExceptionResolver.getPropertyValues().add(&quot;contentNegotiationManager&quot;, contentNegotiationManager);</div><div>        exceptionHandlerExceptionResolver.getPropertyValues().add(&quot;messageConverters&quot;, messageConverters);</div><div>        exceptionHandlerExceptionResolver.getPropertyValues().add(&quot;order&quot;, 0);</div><div>        String methodExceptionResolverName =</div><div>                parserContext.getReaderContext().registerWithGeneratedName(exceptionHandlerExceptionResolver);</div><div><br/></div><div>        RootBeanDefinition responseStatusExceptionResolver = new RootBeanDefinition(ResponseStatusExceptionResolver.class);</div><div>        responseStatusExceptionResolver.setSource(source);</div><div>        responseStatusExceptionResolver.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        responseStatusExceptionResolver.getPropertyValues().add(&quot;order&quot;, 1);</div><div>        String responseStatusExceptionResolverName =</div><div>                parserContext.getReaderContext().registerWithGeneratedName(responseStatusExceptionResolver);</div><div><br/></div><div>        RootBeanDefinition defaultExceptionResolver = new RootBeanDefinition(DefaultHandlerExceptionResolver.class);</div><div>        defaultExceptionResolver.setSource(source);</div><div>        defaultExceptionResolver.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</div><div>        defaultExceptionResolver.getPropertyValues().add(&quot;order&quot;, 2);</div><div>        String defaultExceptionResolverName =</div><div>                parserContext.getReaderContext().registerWithGeneratedName(defaultExceptionResolver);</div><div><br/></div><div>        parserContext.registerComponent(new BeanComponentDefinition(handlerMappingDef, methodMappingName));</div><div>        parserContext.registerComponent(new BeanComponentDefinition(handlerAdapterDef, handlerAdapterName));</div><div>        parserContext.registerComponent(new BeanComponentDefinition(uriCompContribDef, uriCompContribName));</div><div>        parserContext.registerComponent(new BeanComponentDefinition(exceptionHandlerExceptionResolver, methodExceptionResolverName));</div><div>        parserContext.registerComponent(new BeanComponentDefinition(responseStatusExceptionResolver, responseStatusExceptionResolverName));</div><div>        parserContext.registerComponent(new BeanComponentDefinition(defaultExceptionResolver, defaultExceptionResolverName));</div><div>        parserContext.registerComponent(new BeanComponentDefinition(mappedCsInterceptorDef, mappedInterceptorName));</div><div><br/></div><div>        // Ensure BeanNameUrlHandlerMapping (SPR-8289) and default HandlerAdapters are not &quot;turned off&quot;</div><div>        MvcNamespaceUtils.registerDefaultComponents(parserContext, source);</div><div><br/></div><div>        parserContext.popAndRegisterContainingComponent();</div><div><br/></div><div>        return null;</div><div>    }</div></div><div><br/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);"><br/></span></span></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">1、只要请求不好使就召唤mvc:annotation-driven；</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">1）、</span></span></span></span><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">mvc:default-servlet-handler</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">/&gt;  &lt;</span></font><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">mvc:annotation-driven/&gt;</span></span></span></span></div><div><font color="#3F7F7F" face="Consolas"><span style="font-size: 21px;">现象：</span></font></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);">     1）、都没配？动态资源（@RequestMapping映射的资源能访问，静态资源（.html,.js,.img））</span></span></span></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);">     HandlerMapping：</span></span></span></div><div>                              <img src="0325_SpringMVC_files/Image [32].png" type="image/png" style="height: auto;"/></div><div><img src="0325_SpringMVC_files/Image [33].png" type="image/png" style="height: auto;"/></div><div>               动态能访问：</div><div align="left" style="min-height: 18pt;"><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">DefaultAnnotationHandlerMapping中的handlerMap中保存了每一个资源的映射信息；</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);">     静态不能访问：</span></span></span></div><div><font color="#010101" face="Consolas"><span style="font-size: 21px;">就是handlerMap中没有保存静态资源映射的请求，</span></font></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);">     HandlerAdapter：方法执行的适配器；</span></span></span></div><div><img src="0325_SpringMVC_files/Image [34].png" type="image/png" style="height: auto;"/></div><div align="left" style="min-height: 18pt;"><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">AnnotationMethodHandlerAdapter:帮我们执行目标方法；过时的；</span></font></div></div></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);"><br/></span></span></span></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);">     2）、加上</span></span></span><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">mvc:default-servlet-handler</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">/&gt;，</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">mvc:annotation-driven/&gt;</span></span></span></span> ，<font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">不加静态资源ok，动态资源完蛋</span></font></div><div><font color="#008080" face="Consolas"><span style="font-size: 21px;">HandlerMapping中  变化；</span></font></div><div><img src="0325_SpringMVC_files/Image [35].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">动态不能访问：DefaultAnnotationHandlerMapping没有了；用</span></font><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">SimpleUrlHandlerMapping替换了，他的作咏就是将所有请求直接交给tomcat；</span></font></div><div><font color="#010101" face="Consolas"><span style="font-size: 21px;">静态能访问的原因：</span></font><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">SimpleUrlHandlerMapping把所有请求都映射给tomcat；</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div><font color="#010101" face="Consolas"><span style="font-size: 21px;">HandlerAdapter：</span></font></div><div><img src="0325_SpringMVC_files/Image [36].png" type="image/png" style="height: auto;"/></div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">AnnotationMethodHandlerAdapter都没有了；</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);"><span style="color: rgb(0, 128, 128);">     3）、加上</span></span></span></span><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">mvc:default-servlet-handler</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">/&gt;，加上</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">mvc:annotation-driven/&gt;；才都能访问</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">HandlerMapping变化</span></span></span></span></div><div><img src="0325_SpringMVC_files/Image [37].png" type="image/png" style="height: auto;"/></div><div align="left" style="min-height: 18pt;"><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">RequestMappingHandlerMapping:动态资源可以访问</span></font></div><div><img src="0325_SpringMVC_files/Image [38].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 19px;"><b>handleMethods属性保存了每一个请求用哪个方法来处理；</b></span></div><div><br/></div><div><br/></div></div><div><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;">SimpleUrlHandlerMapping：将请求直接交给tomcat；有他，静态资源就没问题；</span></span></div><div><br/></div><div><span style="font-size: 24px;">HandlerAdapter：</span></div><div><img src="0325_SpringMVC_files/Image [39].png" type="image/png" style="height: auto;"/></div><div>原来的</div><div><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">AnnotationMethodHandlerAdapter；被换成</span></font><font color="#010101" face="Consolas" size="4"><span style="font-size:16pt">RequestMappingHandlerAdapter；</span></font></div><div><font color="#010101" face="Consolas"><span style="font-size: 21px;">确定参数都用成解析器了</span></font></div><div><img src="0325_SpringMVC_files/Image [40].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);"><br/></span></span></span></span></div><div><hr/></div><div><font color="#3F7F7F" face="Consolas"><span style="font-size: 21px;">格式化：</span></font></div><div><font color="#3F7F7F" face="Consolas"><span style="font-size: 21px;">页面提交的数据格式如果不正确，就是400；</span></font></div><div><font color="#3F7F7F" face="Consolas"><span style="font-size: 21px;">日期格式：2017-12-19</span></font></div><div align="left" style="min-height: 18pt;"><div><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe"><i>ConversionServiceFactoryBean:创建的ConversionService组件是没有格式化器存在的；</i></span></font></div><div><i><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);"><span style="color: rgb(42, 0, 255);"><br/></span></span></span></span></i></div><div><hr/></div><div><font color="#2A00FF" face="Consolas"><span style="font-size: 21px;"><i>数据校验；</i></span></font></div><div><font color="#2A00FF" face="Consolas"><span style="font-size: 21px;"><i>只做前端校验是不安全的；</i></span></font></div><div><font color="#2A00FF" face="Consolas"><span style="font-size: 21px;"><i>在重要数据一定要加上后端验证；</i></span></font></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">1）、可以写程序将我们每一个数据取出进行校验，如果失败直接来到添加页面，提示其重新填写；x</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">2）、SpringMVC；可以JSR303来做数据校验</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">     JDBC:规范---实现（各个厂商的驱动包）</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">     JSR303：规范-----Hibernate Validator（第三方校验框架）</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">          </span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">3）、如何快速的进行后端校验；</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">     1）、导入校验框架的jar包；</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">      有几个带el的jar不导入；tomcat中有；如果tomcat的版本是</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">          7.0以下；tomcat7.0以上el表达式比较强大；</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">          如果是7.0以下将带el的几个jar放在tomcat的lib文件夹下；<br/></span></span></span></i></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    hibernate-validator-5.0</span><span style="font-size:16pt"><u>.0</u></span><span style="font-size:16pt">.</span><span style="font-size:16pt"><u>CR2</u></span><span style="font-size:16pt">.jar</span></font></div><div align="left" style="min-height: 11pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span><span style="font-size:16pt"><u>hibernate</u></span><span style="font-size:16pt">-validator-annotation-processor-5.0</span><span style="font-size:16pt"><u>.0</u></span><span style="font-size:16pt">.CR2.</span><span style="font-size:16pt"><u>jar</u></span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    classmate-0.8</span><span style="font-size:16pt"><u>.0</u></span><span style="font-size:16pt">.</span><span style="font-size:16pt"><u>jar</u></span></font></div></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span><span style="font-size:16pt"><u>jboss</u></span><span style="font-size:16pt">-</span><span style="font-size:16pt"><u>logging</u></span><span style="font-size:16pt">-3.1</span><span style="font-size:16pt"><u>.1</u></span><span style="font-size:16pt">.</span><span style="font-size:16pt"><u>GA</u></span><span style="font-size:16pt">.jar</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span><span style="font-size:16pt"><u>validation</u></span><span style="font-size:16pt">-api-1.1</span><span style="font-size:16pt"><u>.0</u></span><span style="font-size:16pt">.CR1.</span><span style="font-size:16pt"><u>jar</u></span></font></div><div><u><span style="font-size: 16pt;"><span style="font-family: Consolas;"><br/></span></span></u></div></div></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">     2）、只需要给javaBean的属性添加上校验注解</span></span></span></i></div><div>                         <img src="0325_SpringMVC_files/Image [41].png" type="image/png" style="height: auto;"/></div><div>               </div></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);">      3</span></span></span><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">）、在SpringMVC封装对象的时候，告诉SpringMVC这个javaBean需要校验</span></span></span></i></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);">         </span></span></span><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe"><b>          public</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">String addEmp(</span></font><font color="#646464" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">@Valid</span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">Employee employee) {</span></font></div></div></div><div><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(63, 127, 127);">      <span style="color: rgb(42, 0, 255);"><i>4</i></span></span></span></span><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">）、如何知道校验结果；</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">          给需要校验的javaBean后面紧跟一个BindingResult。这个BindingResult就是封装前一个bean的校验结果；</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">       5）、根据不同的校验结果决定怎么办？</span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);"><br/></span></span></span></i></div><div><i><span style="font-size: 21px;"><span style="font-family: Consolas;"><span style="color: rgb(42, 0, 255);">       6）、来到页面使用form:errors取出错误信息即可；</span></span></span></i></div><div><img src="0325_SpringMVC_files/Image [42].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);"><br/></span></span></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">1）、原生的表单怎么办？</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">     将错误放在请求域中就行了；</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);"><br/></span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">2）、国际化定制自己的错误消息显示；</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">     编写国际化的文件；</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">          errors_zh_CN.properties</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">          errors_en_US.properties</span></span></span></span></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">key=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe"><u>lastname</u></span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">between</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">6</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">and</span></font> <font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">18</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);"><span style="color: rgb(42, 0, 255);">          key有规定；</span></span></span></span></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Field error in object 'employee' on field 'birth':</div><div>     rejected value [Aa];</div><div>     <span style="color: rgb(227, 0, 0);">codes</span> [typeMismatch.employee.birth,typeMismatch.birth,typeMismatch.java.util.Date,typeMismatch];</div><div>     arguments [org.springframework.context.support.DefaultMessageSourceR</div></div><div><br/></div></div></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Field error in object 'employee' on field 'email':</div><div>     rejected value [a];</div><div>     <span style="color: rgb(255, 0, 0);">codes</span> [Email.employee.email,Email.email,Email.java.lang.String,Email];</div><div>      arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [employee.email,email]; arguments []; default message [email],[Ljavax.validation.constraints.Pattern$Flag;@7f9bea7,.*];</div><div>     default message [不是一个合法的电子邮件地址]</div></div><div><br/></div><div>每一个字段发生错误以后，都会有自己的错误代码；国际化文件中错误消息的key必须对应一个错误代码</div><div><hr/></div><div> <span style="color: rgb(255, 0, 0);">codes</span></div><div>     [</div><div>          Email.employee.email,      校验规则.隐含模型中这个对象的key.对象的属性</div><div>          Email.email,                       校验规则.属性名</div><div>          Email.java.lang.String,      校验规则.属性类型</div><div>          Email</div><div>    ];</div><div>1、如果是隐含模型中employee对象的email属性字段发生了@Email校验错误，就会生成 Email.employee.email;</div><div>2、 Email.email：所有的email属性只要发生了@Email错误；</div><div>3、 Email.java.lang.String,:只要是String类型发生了@Email错误</div><div>4、Email：只要发生了@Email校验错误；</div></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);"><br/></span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">1、先编写国际化配置文件</span></span></span></span></div><div><img src="0325_SpringMVC_files/Image [43].png" type="image/png" style="height: auto;"/></div><div>2、让SpringMVC管理国际化资源文件；</div><div align="left" style="min-height: 18pt;"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- 管理国际化资源文件 --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">bean</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">id</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;messageSource&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">class</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;basename&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;errors&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">bean</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);">3、来到页面取值</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);">4、高级国际化？</span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);">     动态传入消息参数；</span></span></span></div><div><img src="0325_SpringMVC_files/Image [44].png" type="image/png" style="height: auto;"/></div></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">{0}：永远都是当前属性名；</span></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(212, 212, 212);"><span style="color: rgb(63, 127, 127);">{1}、{2}</span></span></span></span></div></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><hr/></div><div><font face="Arial Unicode MS" size="6">ajax；</font></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">1、SpringMVC快速的完成ajax功能？</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     1）、返回数据是json就ok；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     2）、页面,$.ajax()；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">2、原生javaWeb：</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     1）、导入GSON；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     2）、返回的数据用GSON转成json</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     3）、写出去；</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">3、SpringMVC-ajax：</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     1、导包</span></span></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt"><u>jackson</u></span><span style="font-size:16pt">-annotations-2.1.5.jar</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt"><u>jackson</u></span><span style="font-size:16pt">-core-2.1.5.jar</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt"><u>jackson</u></span><span style="font-size:16pt">-</span><span style="font-size:16pt"><u>databind</u></span><span style="font-size:16pt">-2.1.5.jar</span></font></div></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     2、写配置</span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';">     3、测试<br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div><div><span style="font-size: 26px;"><span style="font-family: 'Arial Unicode MS';"><br/></span></span></div></span>
</div>
<hr>
<a name="3357"/>
<h1>10、拦截器</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/24 10:20</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/24 14:44</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>SpringMVC提供了拦截器机制；允许运行目标方法之前进行一些拦截工作，或者目标方法运行之后进行一些其他处理；</div><div>Filter；javaWeb</div><div>HandlerInterceptor：SpringMVC</div><div><img src="0325_SpringMVC_files/Image [45].png" type="image/png" style="height: auto;"/></div><div>preHandle：在目标方法运行之前调用；返回boolean；return true；(chain.doFilter())放行； return false；不放行</div><div>postHandle：在目标方法运行之后调用：目标方法调用之后</div><div>afterCompletion：在请求整个完成之后；来到目标页面之后；chain.doFilter()放行；资源响应之后；</div><div>1）、拦截器是一个接口</div><div>2）、实现HandlerInterceptor接口；</div><div>3）、配置拦截器</div><div>4）、拦截器的运行流程</div><div>正常运行流程；</div><div align="left" style="min-height: 18pt;"><div> 拦截器的preHandle------目标方法-----拦截器postHandle-----页面-------拦截器的afterCompletion;</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>MyFirstInterceptor...preHandle...</div><div>test01....</div><div>MyFirstInterceptor...postHandle...</div><div>success.jsp....</div><div>MyFirstInterceptor...afterCompletion</div></div><div>其他流程：</div><div>1、只要preHandle不放行就没有以后的流程；</div><div>2、只要放行了，afterCompletion都会执行；</div><div><br/></div><div><hr/></div><div>2、多个拦截器</div><div>正常流程：</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>MyFirstInterceptor...preHandle...</div><div>MySecondInterceptor...preHandle...</div><div>test01....</div><div>MySecondInterceptor...postHandle...</div><div>MyFirstInterceptor...postHandle...</div><div>success.jsp....</div><div>MySecondInterceptor...afterCompletion...</div><div>MyFirstInterceptor...afterCompletion</div></div><div>异常流程：</div><div>1、不放行；</div><div>     1)、哪一块不放行从此以后都没有；</div><div>     MySecondInterceptor不放行；但是他前面<span style="color: rgb(227, 0, 0);">已经放行了的拦截器的afterCompletion总会执行；</span></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>MyFirstInterceptor...preHandle...</div><div>MySecondInterceptor...preHandle...</div><div>MyFirstInterceptor...afterCompletion</div></div><div>流程：filter的流程；</div><div>拦截器的preHandle：是按照顺序执行</div><div>拦截器的postHandle：是按照逆序执行</div><div>拦截器的afterCompletion：是按照逆序执行；</div><div><span style="color: rgb(227, 0, 0);">已经放行了的拦截器的afterCompletion总会执行；</span></div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>try {</div><div>            ModelAndView mv = null;</div><div>            Exception dispatchException = null;</div><div><br/></div><div>            try {</div><div>                processedRequest = checkMultipart(request);</div><div>                multipartRequestParsed = processedRequest != request;</div><div><br/></div><div>                // Determine handler for the current request.拿到方法的执行链，包含拦截器</div><div>               <span style="color: rgb(227, 0, 0);"> mappedHandler = getHandler(processedRequest);</span></div><div>                if (mappedHandler == null || mappedHandler.getHandler() == null) {</div><div>                    noHandlerFound(processedRequest, response);</div><div>                    return;</div><div>                }</div><div><br/></div><div>                // Determine handler adapter for the current request.</div><div>                HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</div><div><br/></div><div>                // Process last-modified header, if supported by the handler.</div><div>                String method = request.getMethod();</div><div>                boolean isGet = &quot;GET&quot;.equals(method);</div><div>                if (isGet || &quot;HEAD&quot;.equals(method)) {</div><div>                    long lastModified = ha.getLastModified(request, mappedHandler.getHandler());</div><div>                    if (logger.isDebugEnabled()) {</div><div>                        String requestUri = urlPathHelper.getRequestUri(request);</div><div>                        logger.debug(&quot;Last-Modified value for [&quot; + requestUri + &quot;] is: &quot; + lastModified);</div><div>                    }</div><div>                    if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</div><div>                        return;</div><div>                    }</div><div>                }</div><div><br/></div><div>               //拦截器preHandle执行位置;有一个拦截器返回false目标方法以后都不会执行；直接跳到afterCompletion</div><div>                <span style="color: rgb(227, 0, 0);">if (!mappedHandler.applyPreHandle(processedRequest, response)) {</span></div><div><span style="color: rgb(227, 0, 0);">                    return;</span></div><div><span style="color: rgb(227, 0, 0);">                }</span></div><div><br/></div><div>                try {</div><div>                    // Actually invoke the handler.适配器执行目标方法</div><div>                  <b>  mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</b></div><div>                }</div><div>                finally {</div><div>                    if (asyncManager.isConcurrentHandlingStarted()) {</div><div>                        return;</div><div>                    }</div><div>                }</div><div><br/></div><div>                applyDefaultViewName(request, mv);</div><div>                 //目标方法只要正常就会走到postHandle;任何期间有异常</div><div>                <b>mappedHandler.applyPostHandle(processedRequest, response, mv);</b></div><div>            }</div><div>            catch (Exception ex) {</div><div>                dispatchException = ex;</div><div>            }</div><div><br/></div><div>            //页面渲染；如果完蛋也是直接跳到afterCompletion；</div><div>            processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</div><div>        }</div><div>        catch (Exception ex) {</div><div>            triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</div><div>        }</div><div>        catch (Error err) {</div><div>            triggerAfterCompletionWithError(processedRequest, response, mappedHandler, err);</div><div>        }</div><div>        finally {</div><div>            if (asyncManager.isConcurrentHandlingStarted()) {</div><div>                // Instead of postHandle and afterCompletion</div><div>                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</div><div>                return;</div><div>            }</div><div>            // Clean up any resources used by a multipart request.</div><div>            if (multipartRequestParsed) {</div><div>                cleanupMultipart(processedRequest);</div><div>            }</div><div>        }</div><div>    }</div></div><div><br/></div><div><hr/></div><div>preHandle</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {</div><div>        if (getInterceptors() != null) {</div><div>            for (int i = 0; i &lt; getInterceptors().length; i++) {</div><div>                HandlerInterceptor interceptor = getInterceptors()[i];</div><div><br/></div><div>                //preHandle-true-false</div><div>                <b>if (!interceptor.preHandle(request, response, this.handler)) {</b></div><div><b>                    //执行完afterCompletion（）;</b></div><div><b>                    triggerAfterCompletion(request, response, null);</b></div><div><b>                    //返回一个false<br/></b></div><div><b>                    return false;</b></div><div><b>                }</b></div><div>               <b>//记录一下索引</b></div><div><b>               //this.interceptorIndex = i;</b></div><div>            }</div><div>        }</div><div>        return true;</div><div>    }</div></div><div><br/></div><div><hr/></div><div>postHandle</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>void applyPostHandle(HttpServletRequest request, HttpServletResponse response, ModelAndView mv) throws Exception {</div><div>        if (getInterceptors() == null) {</div><div>            return;</div><div>        }</div><div>        //逆向执行每个拦截器的postHandle</div><div>        <b>for (int i = getInterceptors().length - 1; i &gt;= 0; i--) {</b></div><div><b>            HandlerInterceptor interceptor = getInterceptors()[i];</b></div><div><b>            interceptor.postHandle(request, response, this.handler, mv);</b></div><div><b>        }</b></div><div>    }</div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,</div><div>            HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception) throws Exception {</div><div><br/></div><div>        boolean errorView = false;</div><div><br/></div><div>        if (exception != null) {</div><div>            if (exception instanceof ModelAndViewDefiningException) {</div><div>                logger.debug(&quot;ModelAndViewDefiningException encountered&quot;, exception);</div><div>                mv = ((ModelAndViewDefiningException) exception).getModelAndView();</div><div>            }</div><div>            else {</div><div>                Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);</div><div>                mv = processHandlerException(request, response, handler, exception);</div><div>                errorView = (mv != null);</div><div>            }</div><div>        }</div><div><br/></div><div>        // Did the handler return a view to render?</div><div>        if (mv != null &amp;&amp; !mv.wasCleared()) {</div><div>             <span style="color: rgb(227, 0, 0);">页面渲染</span></div><div>           <span style="color: rgb(227, 0, 0);"><b> render(mv, request, response);</b></span></div><div>            if (errorView) {</div><div>                WebUtils.clearErrorRequestAttributes(request);</div><div>            }</div><div>        }</div><div>        else {</div><div>            if (logger.isDebugEnabled()) {</div><div>                logger.debug(&quot;Null ModelAndView returned to DispatcherServlet with name '&quot; + getServletName() +</div><div>                        &quot;': assuming HandlerAdapter completed request handling&quot;);</div><div>            }</div><div>        }</div><div><br/></div><div>        if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {</div><div>            // Concurrent handling started during a forward</div><div>            return;</div><div>        }</div><div><br/></div><div>        if (mappedHandler != null) {</div><div>              <b> //页面正常执行afterCompletion；即使没走到这，afterCompletion总会执行；</b></div><div>           <b> mappedHandler.triggerAfterCompletion(request, response, null);</b></div><div>        }</div><div>    }</div></div><div><br/></div><div><hr/></div><div><br/></div></div></div></div></div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, Exception ex)</div><div>            throws Exception {</div><div><br/></div><div>        if (getInterceptors() == null) {</div><div>            return;</div><div>        }</div><div>         </div><div>          //有记录最后一个放行拦截器的索引，从他开始把之前所有放行的拦截器的afterCompletion都执行</div><div>        for (int i = this.<b>interceptorIndex</b>; i &gt;= 0; i--) {</div><div>            HandlerInterceptor interceptor = getInterceptors()[i];</div><div>            try {</div><div>                interceptor.afterCompletion(request, response, this.handler, ex);</div><div>            }</div><div>            catch (Throwable ex2) {</div><div>                logger.error(&quot;HandlerInterceptor.afterCompletion threw exception&quot;, ex2);</div><div>            }</div><div>        }</div><div>    }</div></div><div><br/></div><div><hr/></div><div>preHandle：</div><div><img src="0325_SpringMVC_files/Image [46].png" type="image/png" style="height: auto;"/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>第一次：ConversionServiceExposingInterceptor  interceptorIndex=0；</div><div>第二次：MyFirstInterceptor                    interceptorIndex=1</div><div>第三次；MySecondInterceptor          执行afterCompletion()</div><div>已经放行了的拦截器的afterCompletion总会执行</div></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div> for (int i = this.interceptorIndex; i &gt;= 0; i--) {</div><div>            HandlerInterceptor interceptor = getInterceptors()[i];</div><div>            try {</div><div>                interceptor.afterCompletion(request, response, this.handler, ex);</div><div>            }</div><div>            catch (Throwable ex2) {</div><div>                logger.error(&quot;HandlerInterceptor.afterCompletion threw exception&quot;, ex2);</div><div>            }</div><div>        }</div></div><div><img src="0325_SpringMVC_files/Image [47].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><hr/></div><div><span style="font-size: 16px;">什么时候用Filter什么时候用拦截器？</span></div><div><span style="font-size: 24px;">如果某些功能；需要其他组件配合完成，我们就使用拦截器；</span></div><div><span style="font-size: 24px;">其他情况可以写filter；</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div></div></div></div><div><br/></div></span>
</div>
<hr>
<a name="3365"/>
<h1>11、国际化</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/24 11:37</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/24 14:31</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>1、写好国际化资源文件</div><div>2、让Spring的ResourceBundleMessageSource管理国际化资源文件</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;bean id=&quot;messageSource&quot; class=&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;&gt;</div><div>        &lt;property name=&quot;basename&quot; value=&quot;loginpage/login&quot;&gt;&lt;/property&gt;</div><div>    &lt;/bean&gt;</div></div><div><br/></div></div><div>3、直接去页面取值</div><div>4、现象：是按照浏览器带来语言信息决定；</div><div>          Locale locale = request.getLocale();//获取到浏览器的区域信息</div><div><hr/></div><div>SpringMVC中区域信息是由区域信息解析器得到的；</div><div align="left" style="min-height: 18pt;"><div><font color="#7F0055" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">LocaleResolver</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">localeResolver</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">;</span></font></div><div>默认会用一个<font face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">AcceptHeaderLocaleResolver</span></font></div></div><div>所有用到区域信息的地方，都是用到<font face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">AcceptHeaderLocaleResolver获取的</span></font></div><div align="left" style="min-height: 18pt;"><div><br/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Locale locale = this.localeResolver.resolveLocale(request);</div></div><div><br/></div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">@Override</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    public Locale resolveLocale(HttpServletRequest request) {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        return request.getLocale();</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    }</span></span></span></div></div><div><hr/></div><div><img src="0325_SpringMVC_files/Image [48].png" type="image/png"/></div><div><br/></div><div><hr/></div><div>点击链接切换国际化；（国际化信息是要能改变的）；</div><div><span style="font-size: 16px;">AcceptHeaderLocaleResolver：使用请求头的区域信息</span></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    public Locale resolveLocale(HttpServletRequest request) {</div><div>        return request.getLocale();</div><div>    }</div><div><br/></div><div>    @Override</div><div>    public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) {</div><div>        throw new UnsupportedOperationException(</div><div>                &quot;Cannot change HTTP accept header - use a different locale resolution strategy&quot;);</div><div>    }</div></div><div align="left" style="min-height: 18pt;"><div><br/></div><div><hr/></div><div><br/></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">FixedLocaleResolver：使用系统默认的区域信息</span></font></div></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    public Locale resolveLocale(HttpServletRequest request) {</div><div>        Locale locale = getDefaultLocale();</div><div>        if (locale == null) {</div><div>            locale = Locale.getDefault();</div><div>        }</div><div>        return locale;</div><div>    }</div><div><br/></div><div>    @Override</div><div>    public LocaleContext resolveLocaleContext(HttpServletRequest request) {</div><div>        return new TimeZoneAwareLocaleContext() {</div><div>            @Override</div><div>            public Locale getLocale() {</div><div>                return getDefaultLocale();</div><div>            }</div><div>            @Override</div><div>            public TimeZone getTimeZone() {</div><div>                return getDefaultTimeZone();</div><div>            }</div><div>        };</div><div>    }</div><div><br/></div><div>    @Override</div><div>    public void setLocaleContext(HttpServletRequest request, HttpServletResponse response, LocaleContext localeContext) {</div><div>        throw new UnsupportedOperationException(&quot;Cannot change fixed locale - use a different locale resolution strategy&quot;);</div><div>    }</div></div><div><br/></div></div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">SessionLocaleResolver：区域信息是从session中获取。</span></font></div><div><font face="Consolas">可以根据请求参数创建一个locale对象，把他放在session中；</font></div></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    public Locale resolveLocale(HttpServletRequest request) {</div><div>        Locale locale = (Locale) WebUtils.getSessionAttribute(request, LOCALE_SESSION_ATTRIBUTE_NAME);</div><div>        if (locale == null) {</div><div>            locale = determineDefaultLocale(request);</div><div>        }</div><div>        return locale;</div><div>    }</div></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">CookieLocaleResolver</span></font></div></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>@Override</div><div>    public Locale resolveLocale(HttpServletRequest request) {</div><div>        parseLocaleCookieIfNecessary(request);</div><div>        return (Locale) request.getAttribute(LOCALE_REQUEST_ATTRIBUTE_NAME);</div><div>    }</div></div><div><br/></div></div></div></div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="3369"/>
<h1>12、异常处理</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/24 15:12</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/24 16:21</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div align="left" style="min-height: 18pt;"><div align="left" style="min-height: 18pt;"><div><font face="Consolas"><span style="font-size: 21px;">默认就是这个几个HandlerExceptionResolver</span></font></div><div><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">ExceptionHandlerExceptionResolver</span></font></div></div><div><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">ResponseStatusExceptionResolver</span></font></div><div><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt">DefaultHandlerExceptionResolver</span></font></div><div><font color="#2A00FF" face="Consolas"><span style="font-size: 21.600000381469727px;">如果异常解析器都不能处理就直接抛出去；</span></font></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,</div><div>            HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception) throws Exception {</div><div><br/></div><div>        boolean errorView = false;</div><div><br/></div><div>        <span style="color: rgb(227, 0, 0);"><b>if (exception != null) {//如果有异常</b></span></div><div>            if (exception instanceof ModelAndViewDefiningException) {</div><div>                logger.debug(&quot;ModelAndViewDefiningException encountered&quot;, exception);</div><div>                mv = ((ModelAndViewDefiningException) exception).getModelAndView();</div><div>            }</div><div>           <span style="color: rgb(227, 0, 0);"> else {//处理异常</span></div><div><span style="color: rgb(227, 0, 0);">                Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);</span></div><div><span style="color: rgb(227, 0, 0);">                mv = processHandlerException(request, response, handler, exception);</span></div><div><span style="color: rgb(227, 0, 0);">                errorView = (mv != null);</span></div><div><span style="color: rgb(227, 0, 0);">            }</span></div><div>        }</div><div><br/></div><div>        // Did the handler return a view to render?</div><div>        if (mv != null &amp;&amp; !mv.wasCleared()) {</div><div>               //来到页面</div><div>           <span style="color: rgb(227, 0, 0);"> <b>render(mv, request, response);</b></span></div><div>            if (errorView) {</div><div>                WebUtils.clearErrorRequestAttributes(request);</div><div>            }</div><div>        }</div><div>        else {</div><div>            if (logger.isDebugEnabled()) {</div><div>                logger.debug(&quot;Null ModelAndView returned to DispatcherServlet with name '&quot; + getServletName() +</div><div>                        &quot;': assuming HandlerAdapter completed request handling&quot;);</div><div>            }</div><div>        }</div><div><br/></div><div>        if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {</div><div>            // Concurrent handling started during a forward</div><div>            return;</div><div>        }</div><div><br/></div><div>        if (mappedHandler != null) {</div><div>            mappedHandler.triggerAfterCompletion(request, response, null);</div><div>        }</div><div>    }</div></div><div><br/></div><div align="left" style="min-height: 18pt;"><div>所以异常解析器尝试解析，解析完成进行后续，解析失败下一个解析器</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>protected ModelAndView processHandlerException(HttpServletRequest request, HttpServletResponse response,</div><div>            Object handler, Exception ex) throws Exception {</div><div><br/></div><div>        // Check registered HandlerExceptionResolvers...</div><div>        ModelAndView exMv = null;</div><div>        for (HandlerExceptionResolver handlerExceptionResolver : this.handlerExceptionResolvers) {</div><div>            exMv = handlerExceptionResolver.resolveException(request, response, handler, ex);</div><div>            if (exMv != null) {</div><div>                break;</div><div>            }</div><div>        }</div><div>        if (exMv != null) {</div><div>            if (exMv.isEmpty()) {</div><div>                return null;</div><div>            }</div><div>            // We might still need view name translation for a plain error model...</div><div>            if (!exMv.hasView()) {</div><div>                exMv.setViewName(getDefaultViewName(request));</div><div>            }</div><div>            if (logger.isDebugEnabled()) {</div><div>                logger.debug(&quot;Handler execution resulted in exception - forwarding to resolved error view: &quot; + exMv, ex);</div><div>            }</div><div>            WebUtils.exposeErrorRequestAttributes(request, ex, getServletName());</div><div>            return exMv;</div><div>        }</div><div><br/></div><div>        throw ex;</div><div>    }</div></div><div><br/></div><div><hr/></div><div><br/></div></div><div><br/></div><div align="left" style="min-height: 18pt;"><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>ExceptionHandlerExceptionResolver:@ExceptionHandler</div><div>ResponseStatusExceptionResolver:@ResponseStatus;</div><div>给自定义异常上标注的</div><div><img src="0325_SpringMVC_files/Image [49].png" type="image/png" style="height: auto;"/></div><div><img src="0325_SpringMVC_files/Image [50].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><b>DefaultHandlerExceptionResolver</b>:判断是否SpringMVC自带的异常</div><div>Spring自己的异常：如：HttpRequestMethodNotSupportedException。如果没人处理</div><div><img src="0325_SpringMVC_files/Image [51].png" type="image/png" style="height: auto;"/></div></div><div><img src="0325_SpringMVC_files/Image [52].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div>默认的异常们？</div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>try {</div><div>            if (ex instanceof NoSuchRequestHandlingMethodException) {</div><div>                return handleNoSuchRequestHandlingMethod((NoSuchRequestHandlingMethodException) ex, request, response,</div><div>                        handler);</div><div>            }</div><div>            else if (ex instanceof HttpRequestMethodNotSupportedException) {</div><div>                return handleHttpRequestMethodNotSupported((HttpRequestMethodNotSupportedException) ex, request,</div><div>                        response, handler);</div><div>            }</div><div>            else if (ex instanceof HttpMediaTypeNotSupportedException) {</div><div>                return handleHttpMediaTypeNotSupported((HttpMediaTypeNotSupportedException) ex, request, response,</div><div>                        handler);</div><div>            }</div><div>            else if (ex instanceof HttpMediaTypeNotAcceptableException) {</div><div>                return handleHttpMediaTypeNotAcceptable((HttpMediaTypeNotAcceptableException) ex, request, response,</div><div>                        handler);</div><div>            }</div><div>            else if (ex instanceof MissingServletRequestParameterException) {</div><div>                return handleMissingServletRequestParameter((MissingServletRequestParameterException) ex, request,</div><div>                        response, handler);</div><div>            }</div><div>            else if (ex instanceof ServletRequestBindingException) {</div><div>                return handleServletRequestBindingException((ServletRequestBindingException) ex, request, response,</div><div>                        handler);</div><div>            }</div><div>            else if (ex instanceof ConversionNotSupportedException) {</div><div>                return handleConversionNotSupported((ConversionNotSupportedException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof TypeMismatchException) {</div><div>                return handleTypeMismatch((TypeMismatchException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof HttpMessageNotReadableException) {</div><div>                return handleHttpMessageNotReadable((HttpMessageNotReadableException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof HttpMessageNotWritableException) {</div><div>                return handleHttpMessageNotWritable((HttpMessageNotWritableException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof MethodArgumentNotValidException) {</div><div>                return handleMethodArgumentNotValidException((MethodArgumentNotValidException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof MissingServletRequestPartException) {</div><div>                return handleMissingServletRequestPartException((MissingServletRequestPartException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof BindException) {</div><div>                return handleBindException((BindException) ex, request, response, handler);</div><div>            }</div><div>            else if (ex instanceof NoHandlerFoundException) {</div><div>                return handleNoHandlerFoundException((NoHandlerFoundException) ex, request, response, handler);</div><div>            }</div><div>        }</div><div>        catch (Exception handlerException) {</div><div>            logger.warn(&quot;Handling of [&quot; + ex.getClass().getName() + &quot;] resulted in Exception&quot;, handlerException);</div><div>        }</div><div>        return null;</div><div>    }</div></div><div><br/></div><div><hr/></div><div><img src="0325_SpringMVC_files/Image [53].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 19px;">SimpleMappingExceptionResolver：</span></div><div><span style="font-size: 19px;">通过配置的方式进行异常处理</span></div><div><img src="0325_SpringMVC_files/Image [54].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">bean</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">class</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- exceptionMappings：配置哪些异常去哪些页面 --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;exceptionMappings&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">props</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!-- key：异常全类名；value：要去的页面视图名； --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">                </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">prop</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">key</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;java.lang.NullPointerException&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font><font face="Consolas" size="4"><span style="font-size:16pt"><u>myerror</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">prop</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">            </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">props</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:16pt">&lt;!--指定错误信息取出时使用的key  --&gt;</span></font></div><div align="left" style="min-height: 18pt;"><font face="Consolas" size="4"><span style="font-size:16pt">        </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">name</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;exceptionAttribute&quot;</i></span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt">value</span></font><font face="Consolas" size="4"><span style="font-size:16pt">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt"><i>&quot;ex&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt">property</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div align="left" style="min-height: 18pt;"><div><font face="Consolas" size="4"><span style="font-size:16pt">    </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#d4d4d4">bean</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt">&gt;</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><hr/></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></div></div><div><span style="font-size: 19px;"><br/></span></div></div></div></div></div></span>
</div>
<hr>
<a name="3383"/>
<h1>13、SpringMVC的运行流程</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/24 16:22</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/24 16:36</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><font color="#E30000">SpringMVC运行流程：</font></div><div><span style="color: rgb(227, 0, 0);"><br/></span></div><div><span style="color: rgb(227, 0, 0);">1、所有请求，前端控制器（DispatcherServlet）收到请求，调用doDispatch进行处理</span></div><div><span style="color: rgb(227, 0, 0);">2、根据HandlerMapping中保存的请求映射信息找到，处理当前请求的，处理器执行链（包含拦截器）</span></div><div><span style="color: rgb(227, 0, 0);">3、根据当前处理器找到他的HandlerAdapter（适配器）</span></div><div><span style="color: rgb(227, 0, 0);">4、拦截器的preHandle先执行</span></div><div><span style="color: rgb(227, 0, 0);">5、适配器执行目标方法，并返回ModelAndView</span></div><div>          1）、ModelAttribute注解标注的方法提前运行</div><div>          2）、执行目标方法的时候（确定目标方法用的参数）</div><div>                    1）、有注解</div><div>                    2）、没注解：</div><div>                             1）、 看是否Model、Map以及其他的</div><div>                              2）、如果是自定义类型</div><div>                                             1）、从隐含模型中看有没有，如果有就从隐含模型中拿</div><div>                                              2）、如果没有，再看是否SessionAttributes标注的属性，如果是从Session中拿，如果拿不到会抛异常</div><div>                                             3）、都不是，就利用反射创建对象</div><div><span style="color: rgb(227, 0, 0);">6、拦截器的postHandle执行</span></div><div><span style="color: rgb(227, 0, 0);">7、处理结果；（页面渲染流程）</span></div><div>            <span style="color: rgb(227, 0, 0);"> 1）、如果有异常使用异常解析器处理异常；处理完后还会返回ModelAndView</span></div><div><span style="color: rgb(227, 0, 0);">              2）、调用render进行页面渲染</span></div><div>                         1）、视图解析器根据视图名得到视图对象</div><div>                         2）、视图对象调用render方法；</div><div>              <span style="color: rgb(227, 0, 0);"> 3）、执行拦截器的afterCompletion；</span></div><div><span style="color: rgb(227, 0, 0);"><br/></span></div><div><hr/></div><div><img src="0325_SpringMVC_files/Image [55].png" type="image/png"/></div></span>
</div>
<hr>
<a name="3387"/>
<h1>14、SpringMVC与Spring整合</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/6/24 16:37</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/6/24 16:59</i></td></tr>
<tr><td><b>作者：</b></td><td><i>雷丰阳</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>SpringMVC和Spring整合的目的；分工明确；</div><div>SpringMVC的配置文件就来配置和网站转发逻辑以及网站功能有关的（视图解析器，文件上传解析器，支持ajax，xxx）；</div><div>Spring的配置文件来配置和业务有关的（事务控制，数据源，xxx）；</div><div><br/></div><div><hr/></div><div align="left" style="min-height: 18pt;"><div><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">import</span></font> <font color="#7F007F" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">resource</span></font><font face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">=</span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe"><i>&quot;spring.xml&quot;</i></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:16pt; background:#e8f2fe">/&gt;：可以合并配置文件；</span></font></div><div><span style="font-size: 16pt;"><span style="font-family: Consolas;"><span style="background-color: rgb(232, 242, 254);"><span style="color: rgb(0, 128, 128);"><br/></span></span></span></span></div><div><hr/></div><div><font color="#008080" face="Consolas"><span style="font-size: 21.14285659790039px;">SpringMVC和Spring分容器；</span></font></div><div><font color="#008080" face="Consolas"><span style="font-size: 21.14285659790039px;">Spring管理业务逻辑组件；</span></font></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>    &lt;context:component-scan base-package=&quot;com.atguigu&quot;&gt;</div><div>        &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;</div><div>        &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;/&gt;</div><div>    &lt;/context:component-scan&gt;</div></div><div><br/></div></div><div><font color="#008080" face="Consolas"><span style="font-size: 21.14285659790039px;">SpringMVC管理控制器组件；</span></font></div><div align="left" style="min-height: 18pt;"><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>    &lt;context:component-scan base-package=&quot;com.atguigu&quot; use-default-filters=&quot;false&quot;&gt;</div><div>        &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;</div><div>        &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;/&gt;</div><div>    &lt;/context:component-scan&gt;</div></div><div><br/></div><div><hr/></div><div>Spring是一个父容器，SpringMVC是一个子容器；</div><div>子容器还可以引用父容器的组件；</div><div>父容器不能引用子容器的组件；</div><div><br/></div></div><div><img src="0325_SpringMVC_files/Image [56].png" type="image/png"/></div></div></span>
</div></body></html> 